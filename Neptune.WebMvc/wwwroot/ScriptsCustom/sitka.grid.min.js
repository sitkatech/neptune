function htmlstring(n,t,i){var r=jQuery("<div>"+n+"<\/div>").text().toLowerCase(),u=jQuery("<div>"+t+"<\/div>").text().toLowerCase();return i=="asc"?r.localeCompare(u):u.localeCompare(r)}function getCheckboxCellValue(n){var t=jQuery(jQuery(n).find("[type='checkbox']")[0]).attr("selected"),i=2;return t!="undefined"&&(i=t?1:0),i}function htmlcheckbox(n,t,i){var r=getCheckboxCellValue(n),u=getCheckboxCellValue(t),f=r>=u;return i=="asc"?r>u:u>r}function stripNonNumeric(n){var r,i,t;for(n+="",r=/^\d|\.|-$/,i="",t=0;t<n.length;t++)r.test(n.charAt(t))&&(n.charAt(t)=="."&&i.indexOf(".")!=-1||n.charAt(t)=="-"&&i.length!=0||(i+=n.charAt(t)));return i}function fmtint(n,t,i){n=stripNonNumeric(n);t=stripNonNumeric(t);var r=parseFloat(n),r=isNaN(r)?-99999999999999:r,u=parseFloat(t),u=isNaN(u)?-99999999999999:u;return i=="asc"?r-u:u-r}function htmlinteger(n,t,i){var u=jQuery("<div>"+n+"<\/div>").text(),f=jQuery("<div>"+t+"<\/div>").text(),r=parseInt(u)>parseInt(f);return i=="asc"?r?1:-1:r?-1:1}Array.indexOf||(Array.prototype.indexOf=function(n){for(var t=0;t<this.length;t++)if(this[t]==n)return t;return-1});dhtmlXGridObject.prototype._in_header_formatted_numeric_filter_box=function(n,t){n.innerHTML='<input type="text" style="width:90%; font-size:8pt; font-family:Tahoma; -moz-user-select:text; ">';n.onclick=n.onmousedown=function(n){return(n||event).cancelBubble=!0};n.onselectstart=function(){return event.cancelBubble=!0};this.makeFilter(n.firstChild,t)};dhtmlXGridObject.prototype._in_header_date_range_filter=function(n,t){var e=this,f=this.SitkaGridContainer.grid;n.innerHTML="<div style='width:100%; margin:0 auto; text-align: left;'>From: <input type='text' id='datefrom' style='width:60px;font-size:8pt;-moz-user-select:text; color:#000'><br />To: <input type='text' id='dateto' style='width:60px;font-size:8pt;-moz-user-select:text;color:#000;margin-left:16px'><\/div>";n.onclick=n.onmousedown=function(n){return(n||event).cancelBubble=!0};n.onselectstart=function(){return event.cancelBubble=!0};var i=this.getChildElement(n.firstChild,"datefrom"),r=this.getChildElement(n.firstChild,"dateto"),u=new dhtmlXCalendarObject([i,r]);u.setDateFormat("%m/%d/%Y");u.attachEvent("onClick",function(){f.filterByAll()});this.makeFilter(i,t);this.makeFilter(r,t);i._filter=function(){var n=this.value;return n==""?"":function(t){var i=new Date(Date.parse(n)),r=new Date(Date.parse(t));return i<=r}};r._filter=function(){var n=this.value;return n==""?"":function(t){var i=new Date(Date.parse(n)),r=new Date(Date.parse(t));return i>=r}};this._filters_ready()};dhtmlXGridObject.prototype._sortCore=function(n,t,i,r,u){var f="sort",e;this._sst&&(u.stablesort=this.rowsCol.stablesort,f="stablesort");t.length>4&&(t=window[t]);t=="cus"?(e=this._customSorts[n],u[f](function(n,t){return e(r[n.idd],r[t.idd],i,n.idd,t.idd)})):typeof t=="function"?u[f](function(n,u){return t(r[n.idd],r[u.idd],i,n.idd,u.idd)}):t=="str"?u[f](function(n,t){var u=r[n.idd].toString().toLowerCase(),f=r[t.idd].toString().toLowerCase();return i=="asc"?u>f?1:u<f?-1:0:u<f?1:u>f?-1:0}):t=="num"?u[f](function(n,t){var f=parseFloat(r[n.idd]),u;return f=isNaN(f)?-99999999999999:f,u=parseFloat(r[t.idd]),u=isNaN(u)?-99999999999999:u,i=="asc"?f-u:u-f}):t=="date"&&u[f](function(n,t){var u=Date.parse(r[n.idd])||Date.parse("01/01/1900"),f=Date.parse(r[t.idd])||Date.parse("01/01/1900");return i=="asc"?u-f:f-u})};dhtmlXGridObject.prototype.getChildElement=function(n,t){for(var i=0;i<n.childNodes.length;i++)if(n.childNodes[i].id==t)return n.childNodes[i];return null};dhtmlXGridObject.prototype._in_header_formatted_numeric_filter=function(n,t){this._in_header_html_filter.call(this,n,t);n.firstChild._filter=function(){var n=this.value,r,i="==",t=parseFloat(n.replace("=","")),u=null;return n?n.indexOf("..")!=-1?(n=n.split(".."),t=parseFloat(n[0]),u=parseFloat(n[1]),function(n){return n=stripNonNumeric(n),n>=t&&n<=u?!0:!1}):((r=n.match(/>=|<=|>|</))&&(i=r[0],t=parseFloat(n.replace(i,""))),Function("v"," if (stripNonNumeric(v) "+i+" "+t+" ) return true; return false;")):""}};Sitka.Grid={CellEditStage:{BeforeStart:0,EditorOpened:1,EditorClosed:2}};Sitka.Grid.Class={GridColumn:function(n,t,i,r,u,f,e,o){this.columnName=n;this.title=t;this.width=i;this.align=r;this.type=u;this.sorting=f;this.filtertype=e;this.formatType=o},Grid:function(n,t,i,r,u,f){if(arguments.length!=6)throw new Error("Expects exactly 6 arguments Sitka.Grid.Grid constructor but got "+arguments.length);if(Sitka.Methods.isUndefinedNullOrEmpty(n))throw new Error("Required parameter gridName invalid. Must be unique to a particular grid on particular page.");if(t===undefined||t===null)throw new Error("Required parameter gridElement not provided Sitka.Grid.Grid constructor.");if(i===undefined)throw new Error("Required parameter dataElement not provided Sitka.Grid.Grid constructor.");if(r===undefined||r===null)throw new Error("Required parameter scrollPosition not provided Sitka.Grid.Grid constructor.");if(u===undefined||u===null)throw new Error("Required parameter skin not provided Sitka.Grid.Grid constructor.");if(f===undefined||f===null)throw new Error("Required parameter skinRowHeight not provided Sitka.Grid.Grid constructor.");if(this.gridName=n,this.uniqueGridName="dhtml"+n,this.gridElement=t,this.dataElement=null,this.filterCountElement=null,this.filterDownloadElement=null,i&&(this.dataElement=jQuery(i),!this.dataElement))throw new Error("Could not locate DOM element "+i);if(this.skin=u,this.awaitedRowHeight=f,this._columns=[],this.grid=null,this.grid=new dhtmlXGridObject(this.gridElement),this.grid.setImagePath("/Content/dhtmlx/dhtmlxGrid/codebase/imgs/"),this.htmlFilter.prototype=dhtmlXGridObject.prototype._in_header_text_filter.prototype,this.grid._in_header_html_filter=this.htmlFilter,this.formattedNumericFilter.prototype=dhtmlXGridObject.prototype._in_header_formatted_numeric_filter.prototype,this.grid._in_header_formatted_numeric_filter.prototype=this.formattedNumericFilter,this.textWithDashesFilter.prototype=dhtmlXGridObject.prototype._in_header_text_filter.prototype,this.grid._in_header_text_withdashes_filter=this.textWithDashesFilter,this.strictHtmlFilter.prototype=dhtmlXGridObject.prototype._in_header_select_filter_strict.prototype,this.grid._in_header_select_filter_html_strict=this.strictHtmlFilter,this.grid.SitkaGridContainer=this,this.attachedStatReady=!1,this.SCROLL_TO_FIRST="scrollToFirst",this.SCROLL_TO_LAST="scrollToLast",this.scrollPosition=r,this.scrollPosition!=this.SCROLL_TO_FIRST&&this.scrollPosition!=this.SCROLL_TO_LAST)throw new Error("Unknown scrollPosition "+r);this.footerFormatters=[]}};Sitka.Grid.Class.Grid.prototype.setGridColumns=function(n){this._columns=_(n)};Sitka.Grid.Class.Grid.prototype.getColumnIndexByName=function(n){return this._columns.pluck("columnName").indexOf(n)};Sitka.Grid.Class.Grid.prototype.htmlFilter=function(n,t){dhtmlXGridObject.prototype._in_header_text_filter.call(this,n,t);n.firstChild._filter=function(){return function(t){var r=n.firstChild.value,u=t.toString().replace(/<[^>]*>/g,""),i=u.toLowerCase().indexOf(r.toLowerCase())!=-1;return i||(i=u.replace(/-/g,"").indexOf(r.replace(/-/g,""))!=-1),i}}};Sitka.Grid.Class.Grid.prototype.formattedNumericFilter=function(n){var t=n};Sitka.Grid.Class.Grid.prototype.getValuesFromCheckedGridRows=function(n,t,i){var r=this.grid.getCheckedRows(n),u=this,e=Sitka.Methods.isUndefinedNullOrEmpty(r)?[]:_.map(r.split(","),function(n){return u.grid.cells(n,u.getColumnIndexByName(t)).getValue()}),f={};return f[i]=e,f};Sitka.Grid.Class.Grid.prototype.strictHtmlFilter=function(n,t){dhtmlXGridObject.prototype._in_header_select_filter_strict.call(this,n,t);this.collectValues=function(n){var s=this.callEvent("onCollectValues",[n]),u,f,r,e,i,t,o;if(s!==!0)return s;if(this.isTreeGrid())return this.collectTreeValues(n);for(this.dma(!0),n=this._m_order?this._m_order[n]:n,u={},f=[],this._build_m_order(),r=this._f_rowsBuffer||this.rowsBuffer,e=this.hdr.grid.SitkaGridContainer._columns.value()[n],i=0;i<r.length;i++)t=this._get_cell_value(r[i],n),typeof t=="string"&&typeof e.filtertype!="undefined"&&e.filtertype=="#select_filter_html_strict"&&(t=t.toString().replace(/<[^>]*>/g,""),t=t.replace("&amp;","&")),t&&(!r[i]._childIndexes||r[i]._childIndexes[n]!=r[i]._childIndexes[n-1])&&(u[t]=!0);this.dma(!1);o=this.combos[n];for(d in u)u[d]===!0&&f.push(o?o.get(d)||d:d);return f.sort()};n.firstChild._filter=function(){return function(t){var r=n.firstChild.value,i=t.toString().replace(/<[^>]*>/g,""),u,f;return i=i.replace("&amp;","&"),u=r.length==0||i.length==r.length,f=i.toLowerCase().indexOf(r.toLowerCase())==0,f&&u}}};Sitka.Grid.Class.Grid.prototype.textWithDashesFilter=function(n,t){dhtmlXGridObject.prototype._in_header_text_filter.call(this,n,t);n.firstChild._filter=function(){return function(t){var r=n.firstChild.value,u=t.toString(),i=u.toLowerCase().indexOf(r.toLowerCase())!=-1;return i||(i=u.replace(/-/g,"").indexOf(r.replace(/-/g,""))!=-1),i}}};Sitka.Grid.Class.Grid.prototype.sortOnOtherColumn=function(n,t){this.grid.attachEvent("onBeforeSorting",function(i,r,u){return i==n?(this.sortRows(t,null,u),this.setSortImgState(!0,i,u),!1):!0})};Sitka.Grid.Class.Grid.prototype.filterOnOtherColumn=function(n,t){this.grid.attachEvent("onFilterStart",function(i,r){var f=jQuery.inArray(n,i),u;if(f!=-1){for(u=0;u<i.length;++u)this.filterBy(i[u]==n?t:i[u],r[u],u==0?!1:!0);return this.callEvent("onFilterEnd",[]),!1}return!0})};Sitka.Grid.Class.Grid.prototype.showHideFilterRow=function(n){var f="#"+this.gridElement+" div.xhdr",e="#"+this.gridElement+" div.objbox",t=jQuery(f),i=jQuery(e),r=this.grid.hdr.rows[2],u=r.style.display=="none"?0:1;n==undefined&&(n=!u);u!=n&&(u?(this.clearGridFilters(),r.style.display="none",t.height(t.height()-this.awaitedRowHeight),i.height(i.height()+this.awaitedRowHeight),Sitka.Methods.createCookie(this.getGridCookieName()+"filterVisible","0",null)):(r.style.display=navigator.userAgent.indexOf("MSIE 7.0")>=0?"inline":"table-row",t.height(t.height()+this.awaitedRowHeight),i.height(i.height()-this.awaitedRowHeight),Sitka.Methods.createCookie(this.getGridCookieName()+"filterVisible","1",null)))};Sitka.Grid.Class.Grid.prototype.showHideFilterInstructions=function(){var t="#"+this.gridElement+"filterBox",n=jQuery(t);n.is(":visible")?n.hide():n.show()};Sitka.Grid.Class.Grid.prototype.loadFilterRowState=function(){var n=Sitka.Methods.readCookie(this.getGridCookieName()+"filterVisible");if(n&&n!="")try{this.showHideFilterRow(n)}catch(t){Sitka.Methods.eraseCookie(this.getGridCookieName()+"filterVisible")}};Sitka.Grid.Class.Grid.prototype.setColumnNumberFormats=function(n,t,i){for(var r,u=0;(r=n.indexOf(t,u))>-1;)this.grid.setNumberFormat(i,r,".",","),u=r+1};Sitka.Grid.Class.Grid.prototype.buildWithArguments=function(n,t,i,r,u,f){var s,l,e,h,c,w;this.dataUrl=r;r==null&&this.grid.startFastOperations();s=this._columns.pluck("title").value();t?(this.grid.setHeader(t),this.grid.attachHeader(s)):this.grid.setHeader(s);i&&this.grid.attachHeader(i);this.grid.setInitWidths(this._columns.pluck("width").join());this.grid.setColAlign(this._columns.pluck("align").join());l=this._columns.pluck("type");this.grid.setColTypes(l.join());e=this._columns.pluck("formatType");this.setColumnNumberFormats(e,"integerSitka","0,000");this.setColumnNumberFormats(e,"percentSitka","0.00%");this.setColumnNumberFormats(e,"currencySitka","$0,000");this.setColumnNumberFormats(e,"decimalSitka","0,000.00");this.setColumnNumberFormats(e,"latLongSitka","000.000");this.grid.setColSorting(this._columns.pluck("sorting").join());this.grid.setSkin(this.skin);this.grid.setNoHeader(n);var o=this.gridElement,a=function(){jQuery("#"+o).css("cursor","wait");var n="#"+o+" input";return jQuery(n).each(function(n,t){jQuery(t).attr("disabled","disabled")}),!0},v=function(){jQuery("#"+o).css("cursor","default");var n="#"+o+" input";return jQuery(n).each(function(n,t){jQuery(t).removeAttr("disabled")}),!0},b=function(n){var t=Sitka.Methods.readCookie(y(n)),i="|",r,u;return t==null||t.indexOf(i)==-1?!1:(r=t.split(i,1)[0],u=r.split(",").length,u==n._columns.length)},y=function(n){return"gridSettings"+n.grid.entBox.id},p=function(n){return function(){b(n)?(n.grid.loadSortingFromCookie(),n.grid.loadSizeFromCookie(),n.grid.loadOrderFromCookie()):Sitka.Methods.eraseCookie(y(n))}};return this.grid.entBox.onselectstart=function(){return!0},this.grid.attachEvent("onBeforeSorting",a),this.grid.attachEvent("onAfterSorting",v),this.grid.attachEvent("onXLS",a),this.grid.attachEvent("onXLE",v),this.grid.init(),this.grid.enableEditEvents(!0,!1,!0),this.grid.enableDistributedParsing(this.scrollPosition==this.SCROLL_TO_FIRST,200,100),this.dataElement?(typeof this.dataElement.html=="function"?this.grid.parse(this.dataElement.html().replace(/&nbsp;/g," ")):this.grid.parse(this.dataElement.replace(/&nbsp;/g," ")),p(this)()):r&&(this.grid.attachEvent("onXLE",p(this)),!0&&(this.grid.enableSmartRendering(!0),h=this.awaitedRowHeight,h!=null&&this.grid.setAwaitedRowHeight(h)),f!=null&&this.grid.splitAt(f),this.load(r)),r==null&&this.grid.stopFastOperations(),this.scrollPosition==this.SCROLL_TO_LAST&&(c=this.grid.getRowsNum()-1,c>=0&&(w=this.grid.getRowId(c),this.grid.showRow(w))),this.grid.enableAutoSizeSaving(null,"path=/"),this.grid.enableOrderSaving(null,"path=/"),this.grid.enableSortingSaving(null,"path=/"),this.grid};Sitka.Grid.Class.Grid.prototype.buildWithDataUrl=function(n,t,i){this.buildWithArguments(n,t,null,i)};Sitka.Grid.Class.Grid.prototype.load=function(n){window.dhx4.attachEvent("onLoadXMLError",function(n,t){return t.status!==200&&t.status!==0&&SitkaAjax.errorHandler(t,t.status),!1});this.grid.load(n,"json")};Sitka.Grid.Class.Grid.prototype.setGridInstructions=function(n,t){var i=jQuery(this.grid.objBox);i.append(n).addClass("gridInstruction");t?this.showGridInstructions():this.hideGridInstructions()};Sitka.Grid.Class.Grid.prototype.showGridInstructions=function(){var n=jQuery(this.grid.objBox);jQuery(".gridInstruction",n).show();n.addClass("gridInstructionPane")};Sitka.Grid.Class.Grid.prototype.hideGridInstructions=function(){var n=jQuery(this.grid.objBox);jQuery(".gridInstruction",n).hide();n.removeClass("gridInstructionPane")};Sitka.Grid.Class.Grid.prototype.build=function(n,t,i){this.buildWithArguments(n,t,i,null)};Sitka.Grid.Class.Grid.prototype.formatEdit=function(n,t){this.grid.rowsAr[n].cells[t].className+=" sitkaGridEditable"};Sitka.Grid.Class.Grid.prototype.getGridCookieName=function(){return"grid_ck_"+this.uniqueGridName};Sitka.Grid.Class.Grid.prototype.clearAllCookies=function(){this.grid.clearConfigCookie();this.clearSavedFilterValues();Sitka.Methods.eraseCookie(this.getGridCookieName()+"filterVisible");location.reload(!0)};Sitka.Grid.Class.Grid.prototype.saveFilters=function(){var n=this.getFilterValuesFromGrid(),t=n.join("|");Sitka.Methods.createCookie(this.getGridCookieName(),t,null)};Sitka.Grid.Class.Grid.prototype.getFilterValuesFromGrid=function(){for(var t=[],n=0;n<this.grid.getColumnsNum();n++)t[n]=this.grid.getFilterElement(n)!==null?this.grid.getFilterElement(n).value:null;return t};Sitka.Grid.Class.Grid.prototype.reloadFiltersFromCookie=function(){var i=this.getGridCookieName(),n=Sitka.Methods.readCookie(i),t;n&&n!=""&&(t=n.split("|"),this.setGridFromSavedValues(t))};Sitka.Grid.Class.Grid.prototype.hasSavedFilters=function(){var n=this.getFilterValuesFromGrid(),t=n.join(""),i=jQuery.trim(t);return i.length>0};Sitka.Grid.Class.Grid.prototype.clearSavedFilterValues=function(){Sitka.Methods.eraseCookie(this.getGridCookieName())};Sitka.Grid.Class.Grid.prototype.setFilteringButtonTagName=function(n){this.filterTagName="#"+n};Sitka.Grid.Class.Grid.prototype.showOrHideFilteringButton=function(){this.filterTagName&&(this.hasSavedFilters()?jQuery(this.filterTagName).show():jQuery(this.filterTagName).hide())};Sitka.Grid.Class.Grid.prototype.resetMultiSelectFilters=function(){var n=this.grid.multiSelectFilters;n!=undefined&&jQuery.each(n,function(n,t){t.toggleAllLabelsAndCheckboxes(!0,!0);t.updateSelectTitle();jQuery.each(jQuery(t.selectElem).find("option"),function(n,t){jQuery(t).attr("selected","selected")})})};Sitka.Grid.Class.Grid.prototype.clearGridFilters=function(){var n,t;if(this.grid.filters){for(n=0;n<this.grid.filters.length;n++)t=this.grid.filters[n],t&&(t[0].value="");this.grid.refreshFilters();this.resetMultiSelectFilters();this.grid.filterBy(0,"");this.clearSavedFilterValues();this.showOrHideFilteringButton();this.updateFilterCountElement();this.updateFilterDownloadElement();this.grid.callEvent("onFilterEnd",[])}};Sitka.Grid.Class.Grid.prototype.setGridFromSavedValues=function(n){this.grid.refreshFilters();for(var t=0;t<n.length;t++){if(t>this.grid.getColumnsNum())break;n[t]!==null&&this.grid.getFilterElement(t)!==null&&(this.grid.getFilterElement(t).value=n[t])}this.grid.filterByAll();this.showOrHideFilteringButton()};Sitka.Grid.Class.Grid.prototype.setupCookieFiltering=function(n){var t=this;this.grid.attachEvent("onFilterStart",function(){return t.saveFilters(),t.showOrHideFilteringButton(),!0});this.grid.attachEvent("onXLE",function(){t.reloadFiltersFromCookie()});this.setFilteringButtonTagName(n)};Sitka.Grid.Class.Grid.prototype.setupFilterCountElement=function(n){var t=this;this.filterCountElement=jQuery("#"+n);this.grid.attachEvent("onFilterEnd",function(){t.updateFilterCountElement();t.showOrHideFilteringButton()})};Sitka.Grid.Class.Grid.prototype.setupFilterDownloadElement=function(n){var t=this;this.filterDownloadElement=jQuery("#"+n);this.filterDownloadElement.parent().show();this.grid.attachEvent("onFilterEnd",function(){t.updateFilterDownloadElement();t.showOrHideFilteringButton()})};Sitka.Grid.Class.Grid.prototype.updateFilterCountElement=function(){this.filterCountElement&&this.filterCountElement.html(this.grid.getRowsNum())};Sitka.Grid.Class.Grid.prototype.updateFilterDownloadElement=function(){if(this.filterDownloadElement){var n="all rows",t=this.grid.getRowsNum();t!=this.unfilteredRowCount&&(n=t+" rows");this.filterDownloadElement.html(n)}};Sitka.Grid.Class.Grid.prototype.retrieveValuesFromColumn=function(n){var e=this.getColumnIndexByName(n),r,o,t,u,f,i;if(typeof e=="undefined")return alert(n+" column not defined, so cannot email Persons. Please contact support@sitkatech.com for assistance."),"";for(r=[],o=this.grid.getRowsNum(),t=0;t<o;t++)if(u=this.grid.cellByIndex(t,e).getValue(),!Sitka.Methods.isUndefinedNullOrEmpty(u))for(f=u.split(","),i=0;i<f.length;++i)r.push(parseInt(f[i]));return _.uniq(r)};Sitka.Grid.Class.Grid.prototype.resizeGridWithVerticalFill=function(){var n=jQuery("#"+this.gridElement),i=n.offset().top,r=i+50,u=jQuery(window).height(),t=u-r;t=Math.max(t,300);this.grid.enableAutoHeight(!0,t,!0);this.grid.enableAutoWidth(!0,n.parent().width(),100);this.grid.setSizes();jQuery("#"+this.gridName+"MetaDivID").width(n.width())};Sitka.Grid.Class.Grid.prototype.resizeGridWidths=function(){var n=jQuery("#"+this.gridElement),t=n.parent();this.grid.enableAutoWidth(!0,t.width(),100);this.grid.setSizes();jQuery("#"+this.gridName+"MetaDivID").width(n.width())};