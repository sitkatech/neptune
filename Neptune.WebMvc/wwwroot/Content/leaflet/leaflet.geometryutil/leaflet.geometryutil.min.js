(function(n){var t;if(typeof define=="function"&&define.amd)define(["leaflet"],n);else if(typeof module!="undefined")t=require("leaflet"),module.exports=n(t);else{if(typeof window.L=="undefined")throw"Leaflet must be loaded first";n(window.L)}})(function(n){"use strict";return n.Polyline._flat=n.LineUtil.isFlat||n.Polyline._flat||function(t){return!n.Util.isArray(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]!="undefined"},n.GeometryUtil=n.extend(n.GeometryUtil||{},{distance:function(n,t,i){return n.latLngToLayerPoint(t).distanceTo(n.latLngToLayerPoint(i))},distanceSegment:function(t,i,r,u){var f=t.latLngToLayerPoint(i),e=t.latLngToLayerPoint(r),o=t.latLngToLayerPoint(u);return n.LineUtil.pointToSegmentDistance(f,e,o)},readableDistance:function(n,t){var r=t!=="imperial",i;return r?i=n>1e3?(n/1e3).toFixed(2)+" km":n.toFixed(1)+" m":(n*=1.09361,i=n>1760?(n/1760).toFixed(2)+" miles":n.toFixed(1)+" yd"),i},belongsSegment:function(n,t,i,r){r=r===undefined?.2:r;var u=t.distanceTo(i),f=t.distanceTo(n)+n.distanceTo(i)-u;return f/u<r},length:function(t){var i=n.GeometryUtil.accumulatedLengths(t);return i.length>0?i[i.length-1]:0},accumulatedLengths:function(n){var i,r,t,u;if(typeof n.getLatLngs=="function"&&(n=n.getLatLngs()),n.length===0)return[];for(i=0,r=[0],t=0,u=n.length-1;t<u;t++)i+=n[t].distanceTo(n[t+1]),r.push(i);return r},closestOnSegment:function(t,i,r,u){var f=t.getMaxZoom();f===Infinity&&(f=t.getZoom());var e=t.project(i,f),o=t.project(r,f),s=t.project(u,f),h=n.LineUtil.closestPointOnSegment(e,o,s);return t.unproject(h,f)},closestOnCircle:function(t,i){const e=t.getLatLng(),r=t.getRadius(),o=typeof r=="number"?r:r.radius,l=i.lng,a=i.lat,s=e.lng,h=e.lat,u=l-s,f=a-h,c=Math.sqrt(u*u+f*f),v=s+u/c*o,y=h+f/c*o;return new n.LatLng(y,v)},closest:function(t,i,r,u){var o,h=Infinity,e=null,f,l,c,s,a,v,y,p;if(i instanceof Array){if(i[0]instanceof Array&&typeof i[0][0]!="number"){for(f=0;f<i.length;f++)s=n.GeometryUtil.closest(t,i[f],r,u),s&&s.distance<h&&(h=s.distance,e=s);return e}if(i[0]instanceof n.LatLng||typeof i[0][0]=="number"||typeof i[0].lat=="number")i=n.polyline(i);else return e}if(!(i instanceof n.Polyline))return e;if(o=JSON.parse(JSON.stringify(i.getLatLngs().slice(0))),i instanceof n.Polygon&&(a=function(t){if(n.Polyline._flat(t))t.push(t[0]);else for(var i=0;i<t.length;i++)a(t[i])},a(o)),n.Polyline._flat(o)){if(u){for(f=0,l=o.length;f<l;f++)v=o[f],c=n.GeometryUtil.distance(t,r,v),c<h&&(h=c,e=v,e.distance=c);return e}for(f=0,l=o.length;f<l-1;f++)y=o[f],p=o[f+1],c=n.GeometryUtil.distanceSegment(t,r,y,p),c<=h&&(h=c,e=n.GeometryUtil.closestOnSegment(t,r,y,p),e.distance=c);return e}for(f=0;f<o.length;f++)s=n.GeometryUtil.closest(t,o[f],r,u),s.distance<h&&(h=s.distance,e=s);return e},closestLayer:function(t,i,r){for(var u,s,o=Infinity,h=null,f=null,e=Infinity,c=0,l=i.length;c<l;c++)u=i[c],u instanceof n.LayerGroup?(s=n.GeometryUtil.closestLayer(t,u.getLayers(),r),s.distance<o&&(o=s.distance,h=s)):(u instanceof n.Circle?(f=this.closestOnCircle(u,r),e=n.GeometryUtil.distance(t,r,f)):typeof u.getLatLng=="function"?(f=u.getLatLng(),e=n.GeometryUtil.distance(t,r,f)):(f=n.GeometryUtil.closest(t,u,r),f&&(e=f.distance)),e<o&&(o=e,h={layer:u,latlng:f,distance:e}));return h},nClosestLayers:function(t,i,r,u){var o,s,e,h,c,f,l;if(u=typeof u=="number"?u:i.length,u<1||i.length<1)return null;for(o=[],h=0,c=i.length;h<c;h++)f=i[h],f instanceof n.LayerGroup?(l=n.GeometryUtil.closestLayer(t,f.getLayers(),r),o.push(l)):(f instanceof n.Circle?(e=this.closestOnCircle(f,r),s=n.GeometryUtil.distance(t,r,e)):typeof f.getLatLng=="function"?(e=f.getLatLng(),s=n.GeometryUtil.distance(t,r,e)):(e=n.GeometryUtil.closest(t,f,r),e&&(s=e.distance)),o.push({layer:f,latlng:e,distance:s}));return o.sort(function(n,t){return n.distance-t.distance}),o.length>u?o.slice(0,u):o},layersWithin:function(t,i,r,u){var s,c,e;u=typeof u=="number"?u:Infinity;var h=[],f=null,o=0;for(s=0,c=i.length;s<c;s++)e=i[s],typeof e.getLatLng=="function"?(f=e.getLatLng(),o=n.GeometryUtil.distance(t,r,f)):(f=n.GeometryUtil.closest(t,e,r),f&&(o=f.distance)),f&&o<u&&h.push({layer:e,latlng:f,distance:o});return h.sort(function(n,t){return n.distance-t.distance})},closestLayerSnap:function(t,i,r,u,f){var e,o;return(u=typeof u=="number"?u:Infinity,f=typeof f=="boolean"?f:!0,e=n.GeometryUtil.closestLayer(t,i,r),!e||e.distance>u)?null:(f&&typeof e.layer.getLatLngs=="function"&&(o=n.GeometryUtil.closest(t,e.layer,e.latlng,!0),o.distance<u&&(e.latlng=o,e.distance=n.GeometryUtil.distance(t,o,r))),e)},interpolateOnPointSegment:function(t,i,r){return n.point(t.x*(1-r)+r*i.x,t.y*(1-r)+r*i.y)},interpolateOnLine:function(t,i,r){var l,e,f,a,u,h,c,y,p;if(i=i instanceof n.Polyline?i.getLatLngs():i,l=i.length,l<2)return null;if(r=Math.max(Math.min(r,1),0),r===0)return{latLng:i[0]instanceof n.LatLng?i[0]:n.latLng(i[0]),predecessor:-1};if(r==1)return{latLng:i[i.length-1]instanceof n.LatLng?i[i.length-1]:n.latLng(i[i.length-1]),predecessor:i.length-2};for(e=t.getMaxZoom(),e===Infinity&&(e=t.getZoom()),f=[],a=0,u=0;u<l;u++)f[u]=t.project(i[u],e),u>0&&(a+=f[u-1].distanceTo(f[u]));var v=a*r,s=0,o=0;for(u=0;o<v;u++)h=f[u],c=f[u+1],s=o,o+=h.distanceTo(c);if(h==undefined&&c==undefined)var h=f[0],c=f[1],u=1;return y=o-s!=0?(v-s)/(o-s):0,p=n.GeometryUtil.interpolateOnPointSegment(h,c,y),{latLng:t.unproject(p,e),predecessor:u-1}},locateOnLine:function(t,i,r){var u=i.getLatLngs(),f,l,s,a;if(r.equals(u[0]))return 0;if(r.equals(u[u.length-1]))return 1;var h=n.GeometryUtil.closest(t,i,r,!1),e=n.GeometryUtil.accumulatedLengths(u),v=e[e.length-1],o=0,c=!1;for(f=0,l=u.length-1;f<l;f++)if(s=u[f],a=u[f+1],o=e[f],n.GeometryUtil.belongsSegment(h,s,a,.001)){o+=s.distanceTo(h);c=!0;break}if(!c)throw"Could not interpolate "+r.toString()+" within "+i.toString();return o/v},reverse:function(t){return n.polyline(t.getLatLngs().slice(0).reverse())},extract:function(t,i,r,u){var s,o;if(r>u)return n.GeometryUtil.extract(t,n.GeometryUtil.reverse(i),1-r,1-u);r=Math.max(Math.min(r,1),0);u=Math.max(Math.min(u,1),0);var h=i.getLatLngs(),f=n.GeometryUtil.interpolateOnLine(t,i,r),e=n.GeometryUtil.interpolateOnLine(t,i,u);return r==u?(s=n.GeometryUtil.interpolateOnLine(t,i,u),[s.latLng]):(f.predecessor==-1&&(f.predecessor=0),e.predecessor==-1&&(e.predecessor=0),o=h.slice(f.predecessor+1,e.predecessor+1),o.unshift(f.latLng),o.push(e.latLng),o)},isBefore:function(n,t){if(!t)return!1;var i=n.getLatLngs(),r=t.getLatLngs();return i[i.length-1].equals(r[0])},isAfter:function(n,t){if(!t)return!1;var r=n.getLatLngs(),i=t.getLatLngs();return r[0].equals(i[i.length-1])},startsAtExtremity:function(n,t){if(!t)return!1;var u=n.getLatLngs(),i=t.getLatLngs(),r=u[0];return r.equals(i[0])||r.equals(i[i.length-1])},computeAngle:function(n,t){return Math.atan2(t.y-n.y,t.x-n.x)*180/Math.PI},computeSlope:function(n,t){var i=(t.y-n.y)/(t.x-n.x),r=n.y-i*n.x;return{a:i,b:r}},rotatePoint:function(t,i,r,u){var e=t.getMaxZoom();e===Infinity&&(e=t.getZoom());var o=r*Math.PI/180,s=t.project(i,e),f=t.project(u,e),h=Math.cos(o)*(s.x-f.x)-Math.sin(o)*(s.y-f.y)+f.x,c=Math.sin(o)*(s.x-f.x)+Math.cos(o)*(s.y-f.y)+f.y;return t.unproject(new n.Point(h,c),e)},bearing:function(n,t){var i=Math.PI/180,f=n.lat*i,r=t.lat*i,e=n.lng*i,o=t.lng*i,s=Math.sin(o-e)*Math.cos(r),h=Math.cos(f)*Math.sin(r)-Math.sin(f)*Math.cos(r)*Math.cos(o-e),u=(Math.atan2(s,h)*180/Math.PI+360)%360;return u>=180?u-360:u},destination:function(t,i,r){i=(i+360)%360;var f=Math.PI/180,e=180/Math.PI,o=n.CRS.Earth.R,p=t.lng*f,s=t.lat*f,h=i*f,c=Math.sin(s),l=Math.cos(s),a=Math.cos(r/o),v=Math.sin(r/o),y=Math.asin(c*a+l*v*Math.cos(h)),u=p+Math.atan2(Math.sin(h)*v*l,a-c*Math.sin(y));return u=u*e,u=u>180?u-360:u<-180?u+360:u,n.latLng([y*e,u])},angle:function(n,t,i){var r=n.latLngToContainerPoint(t),u=n.latLngToContainerPoint(i),f=Math.atan2(u.y-r.y,u.x-r.x)*180/Math.PI+90;return f+(f<0?360:0)},destinationOnSegment:function(t,i,r,u){var f=n.GeometryUtil.angle(t,i,r),e=n.GeometryUtil.destination(i,f,u);return n.GeometryUtil.closestOnSegment(t,e,i,r)}}),n.GeometryUtil});