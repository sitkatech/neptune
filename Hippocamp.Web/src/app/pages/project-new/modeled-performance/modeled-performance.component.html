<div class="mt-md-0 mt-4">
    <h2 class="d-inline-block">Modeled Performance</h2>
    <a href="{{getAboutModelingPerformanceURL()}}" class="float-right">About Modeling Performance</a>
</div>
<div class="row m-1">
    <custom-rich-text [customRichTextTypeID]="customRichTextTypeID"></custom-rich-text>
</div>
<div class="row m-1 mb-3">
    <ngb-alert *ngIf="isMostRecentHistoryOfType(ProjectNetworkHistoryStatusTypeEnum.Queued)" [type]="'info'"
        [dismissible]="false">
        Results for this project are currently being calculated. Triggering a new calculation will be disabled until the
        current calculation completes.
    </ngb-alert>
    <div class="col-4 col-md-2">
        <button class="btn btn-hippocamp" (click)="triggerModelRunForProject()"
            [disabled]="isMostRecentHistoryOfType(ProjectNetworkHistoryStatusTypeEnum.Queued)">
            Calculate
        </button>
    </div>
    <div class="col-8 col-md-10">
        <p class="font-weight-bold">Press 'Calculate' to run the model results for your project. You will be notified
            via email
            when the updated results are returned. Toggle the dropdown below to view results for individual BMPs.</p>
        <p class="font-italic">{{getModelResultsLastCalculatedText()}}</p>
    </div>
</div>
<div class="row mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                Location
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12 col-md-6">
                        <table class="table d-block" style="overflow:auto" [style.max-height]="mapHeight">
                            <thead>
                                <th>
                                    BMP Name
                                </th>
                                <th>
                                    <field-definition fieldDefinitionType="TreatmentBMPType" [labelOverride]="'Type'">
                                    </field-definition>
                                </th>
                                <th>
                                    Delineation Area (ac)
                                </th>
                                <th>
                                    <field-definition fieldDefinitionType="FullyParameterized"></field-definition>
                                </th>
                            </thead>
                            <tbody>
                                <tr *ngFor="let treatmentBMP of treatmentBMPs" class="selectable"
                                    [class.selected]="selectedTreatmentBMP?.TreatmentBMPID == treatmentBMP.TreatmentBMPID"
                                    (click)="selectFeatureImpl(treatmentBMP.TreatmentBMPID)">
                                    <td>
                                        {{treatmentBMP.TreatmentBMPName}}
                                    </td>
                                    <td>
                                        {{treatmentBMP.TreatmentBMPTypeName}}
                                    </td>
                                    <td>
                                        {{getDelineationAcreageForTreatmentBMP(treatmentBMP.TreatmentBMPID)}}
                                    </td>
                                    <td>
                                        {{treatmentBMP.IsFullyParameterized ? "Yes" : "No"}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-12 col-md-6">
                        <div #mapDiv id={{mapID}} class="location-card" [style.height]="mapHeight"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row" *ngIf="selectedModelResults != null">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                Model Results
            </div>
            <div class="card-body">
                <ngb-alert *ngIf="getNotFullyParameterizedBMPNames().length > 0" [type]="'warning'"
                    [dismissible]="false">
                    Some of the proposed BMPs (see list below) are not fully parameterized for modeling, or have missing
                    delineations, so these results may be incomplete or inaccurate.
                    <ul>
                        <li *ngFor="let name of getNotFullyParameterizedBMPNames()">{{name}}</li>
                    </ul>
                </ngb-alert>
                <ngb-alert *ngIf="getBMPNamesForDelineationsWithDiscrepancies().length > 0" [type]="'warning'"
                    [dismissible]="false">
                    Some of the proposed BMPs (see list below) have delineations that overlap an existing BMP delineation or another delineation within this project, so these results may be incomplete or inaccurate.
                    <ul>
                        <li *ngFor="let name of getBMPNamesForDelineationsWithDiscrepancies()">{{name}}</li>
                    </ul>
                </ngb-alert>
                <ngb-alert *ngIf="isMostRecentHistoryOfType(ProjectNetworkHistoryStatusTypeEnum.Queued)" [type]="'info'"
                    [dismissible]="false">
                    Results for this project are currently being calculated. The below results will remain until the
                    current calculation completes and then will be discarded in favor of the newer results.
                </ngb-alert>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-4">
                        <ng-select class="mb-3" [(ngModel)]="treatmentBMPIDForSelectedModelResults"
                            [items]="modelingSelectListOptions" [clearable]="false"
                            (change)="updateSelectedModelResults()" bindLabel="TreatmentBMPName"
                            bindValue="TreatmentBMPID">
                        </ng-select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6">
                        <ul id="modeledPerfomanceDisplayTabs" ngbNav #nav="ngbNav" [(activeId)]="activeID" class="nav-tabs">
                            <li [ngbNavItem]="type.key"
                                *ngFor="let type of ModeledPerformanceDisplayTypeEnum | keyvalue : returnZero">
                                <a ngbNavLink>{{type.key}}</a>
                            </li>
                        </ul>
                        <div>
                            <table class="table table-responsive table-striped table-condensed modelResults"
                                *ngIf="activeID === ModeledPerformanceDisplayTypeEnum.Wet">
                                <thead>
                                    <tr style="text-align: center;">
                                        <th class="left">Water Balance Components</th>
                                        <th>Volume (cu-ft/yr)</th>
                                        <th>Percent of Inflow</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngIf="treatmentBMPIDForSelectedModelResults != 0">
                                        <td class="left">To BMP</td>
                                        <td><span>{{selectedModelResults.WetWeatherInflow |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td>--</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Treated and Discharged</td>
                                        <td><span>{{selectedModelResults.WetWeatherTreated |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.WetWeatherTreated /
                                                selectedModelResults.WetWeatherInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Retained or Recycled</td>
                                        <td><span>{{selectedModelResults.WetWeatherRetained |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.WetWeatherRetained /
                                                selectedModelResults.WetWeatherInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Untreated (Bypass or Overflow)</td>
                                        <td><span>{{selectedModelResults.WetWeatherUntreated |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.WetWeatherUntreated /
                                                selectedModelResults.WetWeatherInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                </tbody>
                                <thead>
                                    <tr style="text-align: center;">
                                        <th class="left">Pollutant</th>
                                        <th>Load Reduced</th>
                                        <th>Percent Reduced</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="left">Total Suspended Solids</td>
                                        <td><span>{{selectedModelResults.WetWeatherTSSRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherTSSRemoved/selectedModelResults.WetWeatherTSSInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Nitrogen</td>
                                        <td><span>{{selectedModelResults.WetWeatherTNRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherTNRemoved/selectedModelResults.WetWeatherTNInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Phosphorous</td>
                                        <td><span>{{selectedModelResults.WetWeatherTPRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherTPRemoved/selectedModelResults.WetWeatherTPInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Fecal Coliform</td>
                                        <td><span>{{selectedModelResults.WetWeatherFCRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> billion CFUs</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherFCRemoved/selectedModelResults.WetWeatherFCInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Copper</td>
                                        <td><span>{{selectedModelResults.WetWeatherTCuRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherTCuRemoved/selectedModelResults.WetWeatherTCuInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Lead</td>
                                        <td><span>{{selectedModelResults.WetWeatherTPbRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherTPbRemoved/selectedModelResults.WetWeatherTPbInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Zinc</td>
                                        <td><span>{{selectedModelResults.WetWeatherTZnRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.WetWeatherTZnRemoved/selectedModelResults.WetWeatherTZnInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="table table-responsive table-striped table-condensed modelResults"
                                *ngIf="activeID === ModeledPerformanceDisplayTypeEnum.Dry">
                                <thead>
                                    <tr style="text-align: center;">
                                        <th class="left">Water Balance Components</th>
                                        <th>Volume (cu-ft/yr)</th>
                                        <th>Percent of Inflow</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngIf="treatmentBMPIDForSelectedModelResults != 0">
                                        <td class="left">To BMP</td>
                                        <td><span>{{selectedModelResults.DryWeatherInflow |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td>--</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Treated and Discharged</td>
                                        <td><span>{{selectedModelResults.DryWeatherTreated |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.DryWeatherTreated /
                                                selectedModelResults.DryWeatherInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Retained or Recycled</td>
                                        <td><span>{{selectedModelResults.DryWeatherRetained |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.DryWeatherRetained /
                                                selectedModelResults.DryWeatherInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Untreated (Bypass or Overflow)</td>
                                        <td><span>{{selectedModelResults.DryWeatherUntreated |
                                                neptuneModelingResultSigFig:3 | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.DryWeatherUntreated /
                                                selectedModelResults.DryWeatherInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                </tbody>
                                <thead>
                                    <tr style="text-align: center;">
                                        <th class="left">Pollutant</th>
                                        <th>Load Reduced</th>
                                        <th>Percent Reduced</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="left">Total Suspended Solids</td>
                                        <td><span>{{selectedModelResults.DryWeatherTSSRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherTSSRemoved/selectedModelResults.DryWeatherTSSInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Nitrogen</td>
                                        <td><span>{{selectedModelResults.DryWeatherTNRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherTNRemoved/selectedModelResults.DryWeatherTNInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Phosphorous</td>
                                        <td><span>{{selectedModelResults.DryWeatherTPRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherTPRemoved/selectedModelResults.DryWeatherTPInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Fecal Coliform</td>
                                        <td><span>{{selectedModelResults.DryWeatherFCRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> billion CFUs</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherFCRemoved/selectedModelResults.DryWeatherFCInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Copper</td>
                                        <td><span>{{selectedModelResults.DryWeatherTCuRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherTCuRemoved/selectedModelResults.DryWeatherTCuInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Lead</td>
                                        <td><span>{{selectedModelResults.DryWeatherTPbRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherTPbRemoved/selectedModelResults.DryWeatherTPbInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Zinc</td>
                                        <td><span>{{selectedModelResults.DryWeatherTZnRemoved |
                                                neptuneModelingResultSigFig:2 | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.DryWeatherTZnRemoved/selectedModelResults.DryWeatherTZnInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="table table-responsive table-striped table-condensed modelResults"
                                *ngIf="activeID === ModeledPerformanceDisplayTypeEnum.Total">
                                <thead>
                                    <tr style="text-align: center;">
                                        <th class="left">Water Balance Components</th>
                                        <th>Volume (cu-ft/yr)</th>
                                        <th>Percent of Inflow</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngIf="treatmentBMPIDForSelectedModelResults != 0">
                                        <td class="left">To BMP</td>
                                        <td><span>{{selectedModelResults.TotalInflow | neptuneModelingResultSigFig:3 |
                                                number}}</span></td>
                                        <td>--</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Treated and Discharged</td>
                                        <td><span>{{selectedModelResults.TotalTreated | neptuneModelingResultSigFig:3 |
                                                number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.TotalTreated /
                                                selectedModelResults.TotalInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Retained or Recycled</td>
                                        <td><span>{{selectedModelResults.TotalRetained | neptuneModelingResultSigFig:3 |
                                                number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.TotalRetained /
                                                selectedModelResults.TotalInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Untreated (Bypass or Overflow)</td>
                                        <td><span>{{selectedModelResults.TotalUntreated | neptuneModelingResultSigFig:3
                                                | number}}</span></td>
                                        <td><span>{{100 * selectedModelResults.TotalUntreated /
                                                selectedModelResults.TotalInflow || 0 | number: 0}}</span>%</td>
                                    </tr>
                                </tbody>
                                <thead>
                                    <tr style="text-align: center;">
                                        <th class="left">Pollutant</th>
                                        <th>Load Reduced</th>
                                        <th>Percent Reduced</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="left">Total Suspended Solids</td>
                                        <td><span>{{selectedModelResults.TotalTSSRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalTSSRemoved/selectedModelResults.TotalTSSInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Nitrogen</td>
                                        <td><span>{{selectedModelResults.TotalTNRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalTNRemoved/selectedModelResults.TotalTNInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Phosphorous</td>
                                        <td><span>{{selectedModelResults.TotalTPRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> kg</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalTPRemoved/selectedModelResults.TotalTPInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Fecal Coliform</td>
                                        <td><span>{{selectedModelResults.TotalFCRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> billion CFUs</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalFCRemoved/selectedModelResults.TotalFCInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Copper</td>
                                        <td><span>{{selectedModelResults.TotalTCuRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalTCuRemoved/selectedModelResults.TotalTCuInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Lead</td>
                                        <td><span>{{selectedModelResults.TotalTPbRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalTPbRemoved/selectedModelResults.TotalTPbInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                    <tr>
                                        <td class="left">Total Zinc</td>
                                        <td><span>{{selectedModelResults.TotalTZnRemoved | neptuneModelingResultSigFig:2
                                                | number}}</span> g</td>
                                        <td><span>{{100 *
                                                selectedModelResults.TotalTZnRemoved/selectedModelResults.TotalTZnInflow
                                                || 0 | number: 0}}</span>%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6">
                        <table id="landUseTable" class="table table-responsive table-striped" style="text-align:center">
                            <thead>
                                <tr>
                                    <th style="text-align: left">
                                        <field-definition fieldDefinitionType="LandUse"></field-definition>
                                    </th>
                                    <th style="text-align:center">
                                        <field-definition fieldDefinitionType="Area" [labelAppend]="' (ac)'">
                                        </field-definition>
                                    </th>
                                    <th style="text-align:center">
                                        <field-definition fieldDefinitionType="ImperviousArea" [labelAppend]="' (ac)'">
                                        </field-definition>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr
                                    *ngFor="let hruCharacteristicSummary of selectedTreatmentBMPHRUCharacteristicSummaries">
                                    <td style="text-align: left">{{hruCharacteristicSummary.LandUse}}</td>
                                    <td>{{hruCharacteristicSummary.Area | number:'1.2-2'}}</td>
                                    <td>{{hruCharacteristicSummary.ImperviousCover | number:'1.2-2'}}</td>
                                </tr>
                                <tr style="font-weight: bold">
                                    <td style="text-align: left">
                                        {{selectedTreatmentBMPHRUCharacteristicSummaryTotal.LandUse}}</td>
                                    <td>{{selectedTreatmentBMPHRUCharacteristicSummaryTotal.Area | number:'1.2-2'}}
                                    </td>
                                    <td>{{selectedTreatmentBMPHRUCharacteristicSummaryTotal.ImperviousCover |
                                        number:'1.2-2'}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <p class="font-italic">{{getModelResultsLastCalculatedText()}}</p>
            </div>
        </div>
    </div>
</div>