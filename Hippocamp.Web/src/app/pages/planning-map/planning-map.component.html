<div class="container-fluid">
    <app-alert-display></app-alert-display>
    <div class="row mb-2 justify-content-center">
        <div class="col-12 col-lg-11">
            <h2 class="d-inline-block">Planning Map</h2>
            <custom-rich-text [customRichTextTypeID]="richTextTypeID"></custom-rich-text>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-12 col-lg-11">
            <div class="row no-gutters justify-content-end">
                <div class="col-12 col-sm-6 col-lg-8 control-label text-sm-right align-self-center">
                    OCTA Prioritization Metric Map Overlay:
                </div>
                <div class="col-12 col-sm-6 col-lg-4">
                    <ng-select [(ngModel)]="selectedPrioritizationMetric" [items]="prioritizationMetrics"
                        bindLabel="key" [clearable]="false" (change)="applyPrioritizationMetricOverlay()">
                    </ng-select>
                </div>
            </div>
            <div class="row no-gutters">
                <div class="col-12 col-md-6 col-lg-4 order-last order-md-first">
                    <div class="card overflow-auto" [style.height]="mapHeight">
                        <div class="card-header hippocamp">
                            Selected Treatment BMP
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div *ngIf="selectedTreatmentBMP != null; else noTreatmentBMPSelected"
                                class="container overflow-auto">
                                <strong>BMP</strong>
                                <dl class="row">
                                    <dt class="text-sm-right col-sm-5 col-xs-12">Name</dt>
                                    <dd class="col-sm-7 col-xs-12">
                                        {{selectedTreatmentBMP.TreatmentBMPName}}
                                    </dd>

                                    <dt class="text-sm-right col-sm-5 col-xs-12">
                                        <field-definition fieldDefinitionType="TreatmentBMPType"
                                            [labelOverride]="'Type'">
                                        </field-definition>
                                    </dt>
                                    <dd class="col-sm-7 col-xs-12">
                                        {{selectedTreatmentBMP.TreatmentBMPTypeName}}
                                    </dd>

                                    <dt class="text-sm-right col-sm-5 col-xs-12">Status</dt>
                                    <dd class="col-sm-7 col-xs-12">
                                        {{selectedProject.ProjectStatus.ProjectStatusDisplayName}}
                                    </dd>
                                </dl>
                                <ng-container *ngIf="selectedDelineation != null">
                                    <strong>Delineation</strong>
                                    <dl class="row">
                                        <dt class="text-sm-right col-sm-5 col-xs-12">
                                            <field-definition fieldDefinitionType="Area"></field-definition>
                                        </dt>
                                        <dd class="col-sm-7 col-xs-12">
                                            {{selectedDelineation.DelineationArea}} ac
                                        </dd>

                                        <dt class="text-sm-right col-sm-5 col-xs-12">
                                            <field-definition fieldDefinitionType="DelineationType"
                                                [labelOverride]="'Type'"></field-definition>
                                        </dt>
                                        <dd class="col-sm-7 col-xs-12">
                                            {{selectedDelineation.DelineationTypeName}}
                                        </dd>
                                    </dl>
                                </ng-container>
                                <strong>Project</strong>
                                <dl class="row">
                                    <dt class="text-sm-right col-sm-5 col-xs-12">Name</dt>
                                    <dd class="col-sm-7 col-xs-12">
                                        {{selectedProject.ProjectName}}
                                    </dd>

                                    <dt class="text-sm-right col-sm-5 col-xs-12">
                                        <field-definition fieldDefinitionType="Jurisdiction"></field-definition>
                                    </dt>
                                    <dd class="col-sm-7 col-xs-12">
                                        {{selectedProject.StormwaterJurisdiction.Organization.OrganizationName}}
                                    </dd>
                                    <dt class="text-sm-right col-sm-5 col-xs-12">Associated BMPS</dt>
                                    <dd class="col-sm-7 col-xs-12"></dd>
                                    <dt class="text-sm-right col-sm-5 col-xs-12"></dt>
                                    <dd class="col-sm-7 col-xs-12"></dd>
                                    <ng-container *ngFor="let bmp of relatedTreatmentBMPs">
                                        <dt class="col-12 col-sm-5 text-sm-right">
                                            <button class="btn btn-primary btn-sm"
                                                (click)="selectFeatureImpl(bmp.TreatmentBMPID)">Select</button>
                                        </dt>
                                        <dd class="col-12 col-sm-7 ">
                                            {{bmp.TreatmentBMPName}}
                                        </dd>
                                    </ng-container>
                                </dl>
                            </div>
                            <ng-container *ngIf="selectedTreatmentBMP">
                                <a routerLink="/projects/{{selectedProject.ProjectID}}"
                                    class="d-inline-block btn btn-hippocamp">View Project Details</a>
                            </ng-container>
                            <ng-container *ngIf="selectedPrioritizationMetric != PrioritizationMetric.NoMetric">
                                <hr class="w-100">
                                <p class="text-center">{{selectedPrioritizationMetric.toString()}} Legend</p>
                                <div class="row justify-content-center">
                                    <div class="col-6">
                                        <ng-container
                                            *ngFor="let legendColor of selectedPrioritizationMetric.legendColors | slice: 0 : 4; index as i">
                                            <div class="row">
                                                <div class="col-6 mt-auto mb-auto text-right">
                                                    <div class="metric-color-swatch ml-auto"
                                                        [style.background]="legendColor">
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <p class="mt-auto mb-auto text-left">
                                                        {{selectedPrioritizationMetric.legendValues[i]}}
                                                    </p>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                    <div class="col-6">
                                        <ng-container
                                            *ngFor="let legendColor of selectedPrioritizationMetric.legendColors | slice: 4; index as i">
                                            <div class="row">
                                                <div class="col-6 mt-auto mb-auto">
                                                    <div class="metric-color-swatch ml-auto"
                                                        [style.background]="legendColor">
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <p class="mt-auto mb-auto text-left">
                                                        {{selectedPrioritizationMetric.legendValues[i+4]}}
                                                    </p>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>

                            </ng-container>
                        </div>
                        <ng-template #noTreatmentBMPSelected>
                            <div>
                                Select a Treatment BMP on the map to see information about the
                                Treatment BMP, its Project and related Treatment BMPs, and Delineation if present
                            </div>
                        </ng-template>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-8 mb-1 mb-md-0">
                    <div id={{mapID}} class="location-card" [style.min-height]="mapHeight" [style.height]="'100%'">
                    </div>
                </div>
            </div>
            <div class="row mb-2">
                <div class="col-auto ml-auto">
                    <hippocamp-clear-grid-filters-button [grid]="projectsGrid" class="mr-2">
                    </hippocamp-clear-grid-filters-button>
                </div>
            </div>
            <ag-grid-angular #projectsGrid class="ag-theme-balham" style="width: 100%; height: 700px;"
                [columnDefs]="columnDefs" [rowData]="projects" [defaultColDef]="defaultColDef" [pagination]="true" [rowSelection]="'single'"
                [paginationPageSize]="100"
                suppressMenuHide="true">
            </ag-grid-angular>
        </div>
    </div>
</div>