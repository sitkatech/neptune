<h1 class="mt-4 mb-4">OCST Trash Module</h1>
<app-alert-display></app-alert-display>

<div class="grid-12">
    <custom-rich-text class="g-col-8" [customRichTextTypeID]="richTextTypeID"></custom-rich-text>

    <div class="hero__actions card g-col-4">
        <ng-container *ngIf="currentUser$ | async as currentUser; else notSignedIn">
            <div class="card-header"><h3 class="card-title">Quick Actions</h3></div>
            <div class="card-body">
                <div class="hero__btns">
                    <div class="hero__btns-wrapper">
                        <a class="float-right btn btn-primary mr-2" [routerLink]="['onland-visual-trash-assessment/new/instructions']">Begin OVTA</a>
                    </div>
                    <div class="hero__btns-wrapper">
                        <a class="btn btn-primary" [routerLink]="['onland-visual-trash-assessment']">View All OVTAs</a>
                    </div>
                    <div class="hero__btns-wrapper">
                        <a class="btn btn-primary" [routerLink]="['onland-visual-trash-assessment-area']">View All OVTA Areas</a>
                    </div>
                    <div class="hero__btns-wrapper">
                        <a class="btn btn-primary" href="{{ requestSupportUrl() }}">Request Support</a>
                    </div>
                </div>
            </div>
        </ng-container>

        <ng-template #notSignedIn>
            <div class="card-header"><h3 class="card-title">Welcome.</h3></div>
            <div class="card-body">
                <p class="mb-2">Log in to view your Account. Create an Account if you don't have one yet.</p>
                <div class="hero__btns">
                    <div class="hero__btns-wrapper">
                        <a (click)="login()" class="btn btn-primary">Login</a>
                    </div>
                    <div class="hero__btns-wrapper">
                        <a (click)="createAccount()" class="btn btn-primary">Create Account</a>
                    </div>
                </div>
                <hr />
                <div>
                    <small style="font-size: 11px">
                        Need help logging in? <br />
                        <a href="{{ forgotPasswordUrl() }}">Forgot Password</a> | <a href="{{ forgotUsernameUrl() }}">Forgot Username</a> |
                        <a href="{{ keystoneSupportUrl() }}">Request Support</a>
                    </small>
                </div>
            </div>
        </ng-template>
    </div>
</div>

<div *ngIf="stormwaterJurisdictions$ | async as stormwaterJurisdictions">
    <div class="card">
        <div class="card-body grid-12">
            <div class="g-col-4"></div>
            <div class="g-col-4">
                <div class="content-section">Viewing Results for</div>
                <div class="dropdown-container">
                    <ng-select
                        [(ngModel)]="currentStormwaterJurisdiction.StormwaterJurisdictionID"
                        (change)="onJurisdictionSelected($event)"
                        [items]="stormwaterJurisdictions"
                        bindLabel="Organization.OrganizationName"
                        bindValue="StormwaterJurisdictionID"
                        [clearable]="false">
                    </ng-select>
                </div>
            </div>
            <div class="g-col-4"></div>
        </div>
     </div>
    <div class="card">
        <div class="card-body">
            
    
            <div class="grid-12">
                <div class="g-col-3">
                    <div class="content-section">Toggle Results and Map Layer:</div>
                    <div class="dropdown-container">
                        <ng-select
                            [(ngModel)]="currentResultType"
                            [items]="resultTypes"
                            [clearable]="false">
                        </ng-select>
                    </div>
                </div>
                <div class="g-col-9">
                    <div [loadingSpinner]="{ isLoading: isLoading, loadingHeight: 100 }" id="areaBasedCalculationControlTemplate" *ngIf="currentResultType == 'Area-Based Results'">
                        <table class="table  table-responsive table-condensed areaBasedCalculationControlTable" *ngIf="areaBasedAcreCalculationsDto$ | async as areaBasedAcreCalculationsDto">
                            <tbody>
                                <tr>
                                    <td class="TGUColumn">
                                        <div id="fullTrashCapture" class="font25" style="color: rgb(76, 146, 76)">{{areaBasedAcreCalculationsDto.FullTrashCaptureAcreage | number : "1.0-0"}}</div>
                                        <p class="greyLabel">acres</p>
                                    </td>
                                    <td class="TGUColumn">
                                        <div id="equivalentArea" class="font25" style="color: rgb(140, 200, 10)">{{areaBasedAcreCalculationsDto.EquivalentAreaAcreage | number : "1.0-0"}}</div>
                                        <p class="greyLabel">acres via OVTA "A"</p>
                                    </td>
                                    <td class="TGUColumn">
                                        <div class="grid-12">
                                        <!-- <div class="col-sm-5 col-xs-12" style=""> -->
                                            <div class="g-col-5">
                                                <div id="totalAcresCaptured" class="font25" style="color: rgb(76, 146, 76);">{{areaBasedAcreCalculationsDto.TotalAcresCaptured | number : "1.0-0"}}</div>
                                                <p class="greyLabel">acres captured</p>
                                            </div>
                                            <!-- <div class="col-sm-1 col-xs-12 table-of"> -->
                                            <div class="g-col-1 table-of">
                                                <strong> of </strong>
                                            </div>
                                            <!-- <div class="col-sm-5 col-xs-12" style=""> -->
                                            <div class="g-col-5">
                                                <div id="totalPLUAcres" class="font25">{{areaBasedAcreCalculationsDto.TotalPLUAcres | number : "1.0-0"}}</div>
                                                <p class="greyLabel">total PLU acres</p>
                                            </div>
                                        </div>
                                        
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td class="TGUColumn" style="width: 20%">
                                        <strong>Full Trash Capture</strong>
                                    </td>
                                    <td class="TGUColumn" style="border-left: none; width:20%">
                                        <strong>Equivalent Area</strong>
                                    </td>
                                    <td class="TGUColumn" style="border-left: none; width:60%">
                                        <strong>Total Full Capture Equivalent</strong>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div [loadingSpinner]="{ isLoading: isLoading, loadingHeight: 100 }" id="LoadBasedResultsControlTemplate" *ngIf="currentResultType == 'Load-Based Results (Current)' || currentResultType == 'Load-Based (Net Change)'">
                        <table class="table table-responsive table-condensed loadBasedCalculationControlTable" *ngIf="loadResultsDto$ | async as loadResultsDto">
                            <tbody>
                                <tr>
                                    <td class="loadBasedResultsColumn" style="width: 18%">
                                        <div id="viaFullTrashCapture" class="font20 loadBased-lightblue bold">{{loadResultsDto.LoadFullCapture | number : "1.0-0"}}</div>
                                        <p class="text-normal greyLabel" style="font-weight: normal"><field-definition fieldDefinitionType="ViaFullCapture"> </field-definition></p>
                                    </td>
                                    <td class="loadBasedResultsColumn" style="width: 21%">
                                        <div id="viaPartialTrashCapture" class="font20 loadBased-lightblue bold">{{loadResultsDto.LoadPartialCapture | number : "1.0-0"}}</div>
                                        <p class="text-normal greyLabel" ><field-definition fieldDefinitionType="ViaPartialCapture"> </field-definition></p>
                                    </td>
                                    <td class="loadBasedResultsColumn" style="width: 21%">
                                        <div id="viaOVTAScore" class="font20 loadBased-lightblue bold">{{loadResultsDto.LoadOVTA | number : "1.0-0"}}</div>
                                        <p class="text-normal greyLabel" >
                                            <field-definition fieldDefinitionType="ViaOVTAScore"> </field-definition>
                                        </p>
                                    </td>
                                    <td class="loadBasedResultsColumn">
                                        <div id="totalAchieved" class="font20 loadBased-blue bold">{{loadResultsDto.TotalAchieved | number : "1.0-0"}}</div>
                                        <p class="text-normal greyLabel" ><field-definition fieldDefinitionType="TotalAchieved"> </field-definition></p>
                                    </td>
                                    <td class="loadBasedResultsColumn" style="border-left: 1px solid rgb(204, 204, 204);">
                                        <div id="targetLoadReduction" class="font20 loadBased-red bold">{{loadResultsDto.TargetLoadReduction | number : "1.0-0"}}</div>
                                        <p><field-definition fieldDefinitionType="TargetLoadReduction"> </field-definition></p>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td class="text-right" colspan="5">
                                        <p class="gpy">gallons per year</p>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div [loadingSpinner]="{ isLoading: isLoading, loadingHeight: 100 }" id="OVTABasedResultsControlTemplate" *ngIf="currentResultType == 'OVTA-Based Results'">
                        <table class="table areaBasedCalculationControlTable" *ngIf="ovtaResultsDto$ | async as ovtaResultsDto">
                            <thead>
                                <tr>
                                    <td class="ovtaResults font15 inline-display">
                                    </td>
                                    <td class="ovtaResults font15" style="width: 8.75%">A</td>
                                    <td class="ovtaResults font15" style="width: 8.75%">B</td>
                                    <td class="ovtaResults font15" style="width: 8.75%">C</td>
                                    <td class="ovtaResults font15" style="width: 8.75%">D</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font15" style="border: none">
                                        <div>Priority Land Use Area (acres)</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="PLUIsA" style="color: rgb(74,222,0)">{{ovtaResultsDto.PLUSumAcresWhereOVTAIsA | number : "1.0-0"}}</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="PLUIsB" style="color: rgb(255,216,0)">{{ovtaResultsDto.PLUSumAcresWhereOVTAIsB | number : "1.0-0"}}</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="PLUIsC" style="color: rgb(255,127,127)">{{ovtaResultsDto.PLUSumAcresWhereOVTAIsC | number : "1.0-0"}}</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="PLUIsD" style="color: rgb(197,0,255)">{{ovtaResultsDto.PLUSumAcresWhereOVTAIsD | number : "1.0-0"}}</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="font15" style="border: none">
                                        <div>Alternate Land Use Area (acres)</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="ALUIsA" style="color: rgb(74,222,0)">{{ovtaResultsDto.ALUSumAcresWhereOVTAIsA | number : "1.0-0"}}</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="ALUIsB" style="color: rgb(255,216,0)">{{ovtaResultsDto.ALUSumAcresWhereOVTAIsB | number : "1.0-0"}}</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="ALUIsC" style="color: rgb(255,127,127)">{{ovtaResultsDto.ALUSumAcresWhereOVTAIsC | number : "1.0-0"}}</div>
                                    </td>
                                    <td class="ovtaResults font15">
                                        <div id="ALUIsD" style="color: rgb(197,0,255)">{{ovtaResultsDto.ALUSumAcresWhereOVTAIsD | number : "1.0-0"}}</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div>
        <div>
            <neptune-map (onMapLoad)="handleMapReady($event)" mapHeight="1000px" [showLegend]="true" *ngIf="boundingBox$ | async as boundingBox" [boundingBox]="boundingBox">
                <land-use-block-layer *ngIf="mapIsReady" [displayOnLoad]="false" [map]="map" [layerControl]="layerControl" [sortOrder]="10"></land-use-block-layer>
                <delineations-layer *ngIf="mapIsReady" [displayOnLoad]="false" [map]="map" [layerControl]="layerControl" [sortOrder]="20"></delineations-layer>
                <inventoried-bmps-trash-capture-layer *ngIf="mapIsReady" [displayOnLoad]="false" [map]="map" [layerControl]="layerControl" [sortOrder]="30"></inventoried-bmps-trash-capture-layer>
                <wqmps-trash-capture-layer *ngIf="mapIsReady" [displayOnLoad]="false" [map]="map" [layerControl]="layerControl" [sortOrder]="40"></wqmps-trash-capture-layer>
                <jurisdictions-layer *ngIf="mapIsReady" [displayOnLoad]="true" [map]="map" [layerControl]="layerControl" [sortOrder]="50"></jurisdictions-layer>
                <regional-subbasins-layer *ngIf="mapIsReady" [displayOnLoad]="false" [map]="map" [layerControl]="layerControl" [sortOrder]="60"></regional-subbasins-layer>
                
                <trash-generating-unit-layer *ngIf="mapIsReady && currentResultType == 'Area-Based Results'"  [displayOnLoad]="true" [map]="map" [layerControl]="layerControl" [sortOrder]="1"></trash-generating-unit-layer>
                <trash-generating-unit-loads-layer *ngIf="mapIsReady && currentResultType == 'Load-Based Results (Current)'"  [displayOnLoad]="true" [map]="map" [layerControl]="layerControl" [sortOrder]="1" [style]="'current_load'"></trash-generating-unit-loads-layer>
                <trash-generating-unit-loads-layer *ngIf="mapIsReady && currentResultType == 'Load-Based (Net Change)'"  [displayOnLoad]="true" [map]="map" [layerControl]="layerControl" [sortOrder]="1" [style]="'delta_load'"></trash-generating-unit-loads-layer>
                <ovta-area-layer *ngIf="mapIsReady && currentResultType == 'OVTA-Based Results'"  [displayOnLoad]="true" [map]="map" [layerControl]="layerControl" [sortOrder]="1"></ovta-area-layer>
            </neptune-map>
        </div>
    </div> 
</div>

