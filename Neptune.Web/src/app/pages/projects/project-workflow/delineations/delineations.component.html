<ng-container [class.d-none]="projectTreatmentBMPs">
    <h2 class="d-inline-block">Delineation Drainage Areas</h2>
    <custom-rich-text [customRichTextTypeID]="customRichTextTypeID"></custom-rich-text>
    <div #mapDiv id="{{ mapID }}" class="location-card" [style.height]="mapHeight" [style.cursor]="isEditingLocation ? 'crosshair' : ''"></div>
    <div class="mt-4 card">
        <div class="card-body bg-white">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Treatment BMP</th>
                            <th>Delineation Area</th>
                            <th>Distributed?</th>
                            <th>Centralized?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr
                            *ngFor="let treatmentBMP of projectTreatmentBMPs"
                            class="selectable"
                            [class.selected]="selectedListItem == treatmentBMP.TreatmentBMPID"
                            (click)="selectFeatureImpl(treatmentBMP.TreatmentBMPID)">
                            <td>{{ treatmentBMP.TreatmentBMPName }}</td>
                            <td [class.font-italic]="!treatmentBMPHasDelineationGeometry(treatmentBMP.TreatmentBMPID)">
                                {{ getDelineationAreaForTreatmentBMP(treatmentBMP.TreatmentBMPID) }}
                            </td>
                            <td>
                                <span *ngIf="getTreatmentBMPDelineation(treatmentBMP.TreatmentBMPID)?.DelineationTypeID == 2">Yes</span>
                                <button
                                    *ngIf="!treatmentBMPHasDelineation(treatmentBMP.TreatmentBMPID)"
                                    class="btn btn-primary"
                                    (click)="drawDelineationForTreatmentBMP(treatmentBMP.TreatmentBMPID)"
                                    [disabled]="isEditingLocation || isPerformingDrawAction || isLoadingSubmit">
                                    Draw on Map
                                </button>
                            </td>
                            <td>
                                <span *ngIf="getTreatmentBMPDelineation(treatmentBMP.TreatmentBMPID)?.DelineationTypeID == 1">Yes</span>
                                <button
                                    *ngIf="!treatmentBMPHasDelineation(treatmentBMP.TreatmentBMPID)"
                                    class="btn btn-primary"
                                    (click)="getUpstreamRSBCatchmentForTreatmentBMP(treatmentBMP.TreatmentBMPID)"
                                    [disabled]="isEditingLocation || isPerformingDrawAction || isLoadingSubmit">
                                    Trace Network
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="mt-4 card" *ngIf="selectedTreatmentBMP">
        <div class="card-body bg-white">
            <h5 class="border-bottom p-2">Location</h5>
            <div class="grid-12">
                <div class="g-col-4">
                    <div class="row d-flex">
                        <div class="col-auto ml-auto text-right">
                            <button
                                class="btn mt-2 btn-outline-info mb-2"
                                (click)="toggleIsEditingLocation()"
                                [disabled]="drawMapClicked || isPerformingDrawAction || isLoadingSubmit">
                                <i class="fa fa-edit mr-1"></i>{{ isEditingLocation ? "Save Location" : "Edit Location" }}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="g-col-5">
                    <dl class="grid-12 mt-3">
                        <ng-container *ngIf="selectedTreatmentBMP.Latitude && selectedTreatmentBMP.Longitude; else noLocationSelected">
                            <dt class="g-col-4">Latitude</dt>
                            <dd class="g-col-8">
                                {{ selectedTreatmentBMP.Latitude }}
                            </dd>
                            <dt class="g-col-4">Longitude</dt>
                            <dd class="g-col-8">
                                {{ selectedTreatmentBMP.Longitude }}
                            </dd>
                            <dt class="g-col-4">
                                <field-definition fieldDefinitionType="Area" [labelOverride]="'Delineation Area'"></field-definition>
                            </dt>
                            <dd class="g-col-8" [class.font-italic]="!treatmentBMPHasDelineation(selectedTreatmentBMP.TreatmentBMPID)">
                                {{ getDelineationAreaForTreatmentBMP(selectedTreatmentBMP.TreatmentBMPID) }}
                            </dd>
                            <ng-container *ngIf="selectedTreatmentBMP.WatershedName">
                                <dt class="g-col-4">
                                    <field-definition [fieldDefinitionType]="'Watershed'"></field-definition>
                                </dt>
                                <dd class="g-col-8">{{ selectedTreatmentBMP.WatershedName }}</dd>
                            </ng-container>
                        </ng-container>
                        <ng-template #noLocationSelected>
                            <div class="font-italic ml-3">"Location details not yet provided."</div>
                        </ng-template>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    <div class="mt-3">
        <div class="col-auto ml-auto">
            <button class="btn btn-outline-primary ml-auto mr-2" [disabled]="isLoadingSubmit" (click)="onSubmit()">
                <span *ngIf="isLoadingSubmit" class="fa fa-spinner loading-spinner"></span>
                Save
            </button>
            <button class="btn btn-primary ml-auto" [disabled]="isLoadingSubmit" (click)="onSubmit(true)">
                <span *ngIf="isLoadingSubmit" class="fa fa-spinner loading-spinner"></span>
                Save and Continue
            </button>
        </div>
    </div>
</ng-container>
