<div class="modal-header">
    <h3 class="section-title">
        <span>{{ ref.data?.editData ? "Edit Funding Event" : "Add Funding Event" }}</span>
    </h3>
</div>

<div class="modal-body grid-12">
    <app-alert-display></app-alert-display>
    <form class="form grid-12" [formGroup]="formGroup">
        <form-field
            class="g-col-12"
            [formControl]="formGroup.controls.FundingEventTypeID"
            fieldLabel="Funding Event Type"
            placeholder="Type"
            [required]="true"
            [type]="FormFieldType.Select"
            [formInputOptions]="fundingEventTypeOptions"></form-field>
        <form-field class="g-col-12" [formControl]="formGroup.controls.Year" fieldLabel="Year" placeholder="Year" [required]="true" [type]="FormFieldType.Number"></form-field>
        <form-field
            class="g-col-12"
            [formControl]="formGroup.controls.Description"
            fieldLabel="Description"
            placeholder="Description"
            [required]="false"
            [type]="FormFieldType.Textarea"></form-field>
        <div class="g-col-12 mt-3">
            @if (hasDuplicateFundingSources) {
                <div class="alert alert-danger mb-2">Duplicate funding sources are not allowed. Please select unique sources for each row.</div>
            }
            <label class="form-label">Funding Sources</label>
            @for (source of getFundingSourceGroups(); track $index) {
                <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem">
                    <form-field
                        style="flex: 2 1 0; min-width: 120px"
                        [formControl]="getFundingSourceIDControl(source)"
                        fieldLabel="Source Name"
                        [type]="FormFieldType.Select"
                        [formInputOptions]="fundingSourceOptions$ | async"
                        placeholder="Select Source"></form-field>
                    <form-field
                        style="flex: 1 1 0; min-width: 80px"
                        [formControl]="getFundingSourceAmountControl(source)"
                        fieldLabel="Amount"
                        placeholder="Amount"
                        [type]="FormFieldType.Number"></form-field>
                    <button type="button" class="btn btn-danger btn-sm mt-3" (click)="removeFundingSource($index)" style="flex: 0 0 auto">
                        <icon icon="Delete"></icon>
                    </button>
                </div>
            }
            <button type="button" class="btn btn-primary-outline btn-sm" (click)="addFundingSource()">Add Funding Source</button>
        </div>
    </form>
</div>

<div class="modal-footer">
    <button class="btn btn-primary" (click)="save()" [disabled]="formGroup.invalid || hasDuplicateFundingSources">
        {{ ref.data?.editData ? "Save Changes" : "Add Funding Event" }}
    </button>
    <button class="btn btn-primary-outline" (click)="cancel()">Cancel</button>
</div>
