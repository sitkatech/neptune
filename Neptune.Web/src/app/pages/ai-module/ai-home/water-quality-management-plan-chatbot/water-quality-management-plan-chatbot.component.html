@if (currentUser$ | async; as currentUser) {
    @if (chatMessages$ | async; as chatMessages) {
        <div class="tb-dialog chatgpt-style grid-12 g-col-12">
            <div class="tb-dialog__body | tb-dialog__body--two-col g-col-12">
                <div class="tb-dialog__main chatgpt-main g-col-12" #main [scrollTop]="main.scrollHeight">
                    <div class="chatgpt-history">
                        @if (chatMessages.length === 0 && !(extractionResult$ | async)) {
                            <div class="intro">
                                <div class="intro__wrapper | copy copy-3">
                                    <img src="./assets/main/icons/icon-leaf.svg" alt="Leaf" />
                                    <p><strong>Hi!</strong> Type your question to start extracting data from the document.</p>
                                </div>
                            </div>
                        }
                        @if (chatMessages.length > 0) {
                            @for (chatMessage of chatMessages; track $index) {
                                @if (chatMessage.Role === "assistant") {
                                    <div class="chatgpt-bubble assistant" [id]="'response-' + ($index + 1)">
                                        <div class="chatgpt-meta">
                                            <icon icon="Stars"></icon>
                                            <span>ChatOCST, </span>
                                            <span class="chatgpt-date">{{ chatMessage.Date | date: "MMM d, y h:mm a" }}</span>
                                        </div>
                                        <div class="chatgpt-content">
                                            @if ((chatMessage.SummaryHtml || chatMessage.Content) && (chatMessage.SummaryHtml || chatMessage.Content) !== "undefined") {
                                                <p [innerHTML]="sanitizeSummaryHtml(chatMessage.SummaryHtml || chatMessage.Content || '')"></p>
                                            } @else {
                                                <span class="chatgpt-loading">
                                                    <span class="wave" aria-hidden="true">
                                                        <span class="wave-char">T</span>
                                                        <span class="wave-char">h</span>
                                                        <span class="wave-char">i</span>
                                                        <span class="wave-char">n</span>
                                                        <span class="wave-char">k</span>
                                                        <span class="wave-char">i</span>
                                                        <span class="wave-char">n</span>
                                                        <span class="wave-char">g</span>
                                                        <span class="wave-char">.</span>
                                                        <span class="wave-char">.</span>
                                                        <span class="wave-char">.</span>
                                                    </span>
                                                </span>
                                            }
                                        </div>
                                    </div>
                                } @else if (chatMessage.Role === "user") {
                                    <div class="chatgpt-bubble user">
                                        <div class="chatgpt-meta">
                                            <icon [icon]="'Leaf'"></icon>
                                            <span>{{ currentUser.FirstName + " " + currentUser.LastName }}, </span>
                                            <span class="chatgpt-date">{{ chatMessage.Date | date: "MMM d, y h:mm a" }}</span>
                                        </div>
                                        <div class="chatgpt-content">
                                            <p>{{ chatMessage.Content }}</p>
                                        </div>
                                    </div>
                                }
                            }
                        }
                        <div class="chatgpt-input-bar">
                            <ai-chat-input placeholder="Ask anything about this WQMP..." [isReceiving]="isReceiving$ | async" (send)="send($event)"></ai-chat-input>
                        </div>
                        <div class="chatgpt-actions">
                            <a role="button" class="chatgpt-action-link" (click)="reset()">Reset Conversation</a>
                            <a role="button" class="chatgpt-action-link" (click)="exportChat()">Export Chat</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
}
