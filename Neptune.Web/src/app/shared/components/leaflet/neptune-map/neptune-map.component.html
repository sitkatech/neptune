<div class="map-wrapper">
  <div class="form-group">
    <div class="field">
      <div class="search-container">
        <div class="search-prepend">
          <i class="fa" [class.fa-search]="!isSearching" [class.fa-spinner]="isSearching" [class.spin-animation]="isSearching"></i>
        </div>
        <input
          onkeydown="return event.key != 'Enter';"
          (keyup.enter)="selectCurrent($event)"
          type="text"
          name="NominatimSearch"
          placeholder="Search locations"
          [formControl]="searchString"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="none"
          spellcheck="false" />
          <div class="search-append">
            @if (searchString.value) {
              <button class="clear" (click)="clearSearch()">
                <i class="fa fa-times-circle"></i>
              </button>
            }
          </div>
        </div>
        @if (searchResults$ | async; as searchResults) {
          <div class="search-results">
            @if (!isSearching) {
              <ul>
                @for (result of searchResults.features; track result) {
                  <li [id]="'Location_' + result.id">
                    <button (click)="selectCurrent(result)">
                      <div class="button-head">
                        <strong class="wa-name" [innerHTML]="result.properties.display_name"></strong>
                      </div>
                    </button>
                  </li>
                }
                @if (searchResults?.features?.length == 0 && searchString.value && searchString.value.length > 1) {
                  <li class="p-3">No results</li>
                }
              </ul>
            }
          </div>
        }
      </div>
    </div>
    <div [id]="mapID" [style.height]="mapHeight" [style.cursor]="cursorStyle">
      @if (showLegend) {
        <div class="legend leaflet-control-layers leaflet-control-layers-expanded" [id]="legendID">
          <a class="leaflet-control-layers-toggle">
            <icon icon="MapLegend" (click)="legendToggle()"></icon>
          </a>
          <div class="leaflet-control-layers-list">
            @for (legendItem of legendItems; track legendItem) {
              <div class="legend-item">
                <h4>{{ legendItem.Title }}</h4>
                @if (legendItem.Icon) {
                  <icon [icon]="legendItem.Icon" [color]="legendItem.IconColor" [fillOpacity]="legendItem.IconFillOpacity"></icon>
                }
                @if (legendItem.Text) {
                  <span>{{ legendItem.Text }}</span>
                }
                @if (legendItem.LegendHtml) {
                  <div [innerHTML]="legendItem.LegendHtml"></div>
                }
                @if (legendItem.WmsUrl) {
                  <img
                        src="{{ legendItem.WmsUrl }}REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=25&HEIGHT=25&LAYER={{
                            legendItem.WmsLayerName
                        }}&legend_options=fontSize:12&style={{ legendItem.WmsLayerStyle }}"
                    alt="{{ legendItem.Title }} Legend" />
                }
              </div>
            }
            <div class="leaflet-control-layers-close-button-wrapper">
              <a [href]="" (click)="legendToggle()">Close</a>
            </div>
          </div>
        </div>
      }
      @if (map) {
        <regional-subbasin-trace-from-point
          [map]="map"
          [cursorStyle]="cursorStyle"
          (cursorStyleChange)="onCursorStyleChange($event)"
          [legendItems]="legendItems"
        (legendItemsChange)="onLegendItemsChange($event)"></regional-subbasin-trace-from-point>
      }
      <ng-content></ng-content>
    </div>
    <div class="map-footer">
      <i style="margin-left: auto"></i>
      <div class="attribution">
        &copy;
        <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>
        contributors
      </div>
    </div>
  </div>
