@using LtInfo.Common.BootstrapWrappers
@using LtInfo.Common.ModalDialog
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@inherits Neptune.Web.Areas.Trash.Views.OnlandVisualTrashAssessment.RefineAssessmentArea

@{ @SetLayout("SiteLayout.cshtml", ViewDataTyped) }

@section JavascriptAndStylesContent
{
    <script src="@Url.Content("~/Areas/Trash/Views/OnlandVisualTrashAssessment/RefineAssessmentArea.js")"></script>
}

@if (!ViewDataTyped.OVTASection.IsSectionEnabled(ViewDataTyped.OVTA))
{
    <p class="systemText">@ViewDataTyped.OVTASection.GetSectionDisabledMessage()</p>
}
else
{

    <p>You may click or tap the edit button (<span class="glyphicon glyphicon-edit"></span>) on the map below to adjust the Assessment Area's vertices. You may drag vertices to move them, or click or tap vertices to delete them. Note that it may be necessary to zoom the map to see individual vertices that are close together (e.g. there may be many closely-placed vertices along curves). You may click the "Reset Map Zoom" button to zoom back out to the entire Assessment Area.</p>

    <p class="systemText">Note that the Assessment Area's edges should not intersect each other. If the area contains any edges that intersect each other, they will be split into separate shapes as necessary.</p>

    <div id="@ViewDataTyped.MapInitJson.MapDivID" style="height: 450px; margin: 0"></div>

    using (Html.BeginForm())
     {
         <div id="@ViewDataTyped.MapFormID">

         </div>
         <div class="row" style="margin-top: 10px;">
             <div class="col-xs-12">
                 <button type="button" class="btn btn-neptune" onclick="resetZoom()">Reset Map Zoom</button>
             </div>
         </div>

         <hr/>
         <div class="row">
             <div class="col-xs-12 col-sm-3">
                 <div><sup>@Html.Raw(BootstrapHtmlHelpers.RequiredIcon)</sup> Required Field</div>
             </div>

             <div class="col-xs-12 col-sm-9" style="text-align: right">
                 <button type="submit" class="btn btn-neptune" value="false" name="@Html.NameFor(x => x.AutoAdvance)">Save</button>
                 <button type="submit" class="btn btn-neptune" value="true" name="@Html.NameFor(x => x.AutoAdvance)">Save &amp; Continue <i class="glyphicon glyphicon-chevron-right"></i></button>
             </div>
         </div>
     }


    <script type="text/javascript">
        var mapInitJson = @Html.Raw(JObject.FromObject(ViewDataTyped.MapInitJson).ToString(Formatting.None));
        var editableFeatureJsonObject =
            @Html.Raw(JObject.FromObject(ViewDataTyped.MapInitJson.AssessmentAreaLayerGeoJson).ToString(Formatting.None));
        var saveButtonID = "@ModalDialogFormHelper.SaveButtonID";

        var updateFeatureCollectionJson = createUpdateFeatureCollectionJsonFunctionAsClosure(
            "@Html.NameFor(m=>m.WktAndAnnotations[0].Wkt)",
            "@Html.NameFor(m => m.WktAndAnnotations[0].Annotation)",
            "@ViewDataTyped.MapFormID");

        var geoServerUrl = "@ViewDataTyped.GeoServerUrl";
        buildMapOnDocumentReady(mapInitJson, editableFeatureJsonObject, saveButtonID,geoServerUrl);


    </script>
}