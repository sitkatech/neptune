@using DocumentFormat.OpenXml.Drawing.Diagrams
@using LtInfo.Common.BootstrapWrappers
@using LtInfo.Common.HtmlHelperExtensions
@using LtInfo.Common.ModalDialog
@using Neptune.Web.Models
@using Neptune.Web.Views.Shared
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@inherits Neptune.Web.Areas.Trash.Views.Home.Index

@section JavascriptAndStylesContent
{
    @{ MapJavascriptIncludes.RenderPartialView(Html); }
    <script src="@Url.Content("~/ScriptsCustom/Maps/NeptuneMaps.GeoServerMap.min.js")" type="text/javascript"></script>
    <script type="text/javascript" src="@Url.Content("~/Areas/Trash/Views/Home/OVTABasedMapController.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Areas/Trash/Views/Home/LoadBasedMapController.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Areas/Trash/Views/Home/AreaBasedMapController.js")"></script>
    <script type="text/javascript">
        // <![CDATA[
        angular.module("NeptuneApp")
            .factory("angularModelAndViewData",
                function() {
                    return {
                        AngularModel: null,
                        AngularViewData:
                            @Html.Raw(JObject.FromObject(ViewDataTyped.ViewDataForAngular).ToString(Formatting.None))
                    };
            });

        jQuery(document).ready(function() {
            jQuery('.selectpicker').selectpicker("val", [1, 2]);
            jQuery('#trashCaptureStatusTypeDropdown').change();
        });
        // ]]>
    </script>

    <style>
        #tcLegend, #ovtaAreaLegend {
            padding-left: 0;
            list-style-type: none;
        }

            #tcLegend img {
                max-height: 50px;
                margin-right: 5px;
            }

            #ovtaAreaLegend img {
                max-height: 25px;
                margin-right: 5px;
                border: 1px solid #ddd;
            }

            #ovtaAreaLegend li {
                padding-bottom: 10px;
            }


        .bootstrap-select {
            padding-left: 0;
        }

        .leaflet-control-layers-list {
            width: 185px !important;
        }
    </style>
}


@section RightOfPageTitle
{
    <button class="btn btn-neptune" onclick="createTguDialog()"><span class="glyphicon glyphicon-refresh" style="margin-right: 5px;"></span>Refresh TGUs</button>
}

@{ ViewPageContent.RenderPartialView(Html, ViewDataTyped.ViewPageContentViewData); }

<div class="row">
    <div class="col-xs-12">
        <h3>Common Tasks</h3>
    </div>

    <div class="col-xs-12 col-sm-6 launchPadAction">
        <div class="row">
            <div class="col-xs-6 col-md-5 col-lg-4">
                <a href="@ViewDataTyped.BeginOVTAUrl" class="btn btn-neptune launchPadActionButton"><span class="glyphicon glyphicon-plus"></span> Begin OVTA</a>
            </div>
            <div class="col-xs-6 col-md-7 col-lg-8">
                Start here to begin a new On-land Visual Trash Assessment
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-6 launchPadAction">
        <div class="row">
            <div class="col-xs-6 col-md-5 col-lg-4">
                <a href="@ViewDataTyped.AllOVTAsUrl" class="btn btn-neptune launchPadActionButton">View all OVTAs</a>
            </div>
            <div class="col-xs-6 col-md-7 col-lg-8">
                See an overview grid of all On-land Visual Trash Assessments
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-6 launchPadAction">
        <div class="row">
            <div class="col-xs-6 col-md-5 col-lg-4">
                <a href="@ViewDataTyped.AddBMPUrl" class="btn btn-neptune launchPadActionButton">Add a BMP</a>
            </div>
            <div class="col-xs-6 col-md-7 col-lg-8">
                Start here to add a new BMP
            </div>
        </div>
    </div>

    <div class="col-xs-12 col-sm-6 launchPadAction">
        <div class="row">
            <div class="col-xs-6 col-md-5 col-lg-4">
                <a href="@ViewDataTyped.FindBMPUrl" class="btn btn-neptune launchPadActionButton">Record a BMP Visit</a>
            </div>
            <div class="col-xs-6 col-md-7 col-lg-8">
                Locate a BMP and begin a Field Visit for it
            </div>
        </div>
    </div>
</div>

<h3>Program Overview</h3>

@{ ViewPageContent.RenderPartialView(Html, ViewDataTyped.ProgramOverviewPageContentViewData); }


<div  ng-app="NeptuneApp">

    <div class="container-fluid">
        <div class="row">
            <ul class="nav nav-tabs" id="organizationDetailsTabs" style="border-bottom: none;">
                <li>
                    <a href="#areaResults" aria-controls="areaResultsOverview" role="tab" data-toggle="tab" id="areaResultsTab">Area-Based Results</a>
                </li>
                <li>
                    <a href="#loadResults" aria-controls="loadResultsOverview" role="tab" data-toggle="tab" id="loadResultsTab">Load-Based Results</a>
                </li>
                <li class="active">
                    <a href="#ovtaResults" aria-controls="ovtaResultsOverview" role="tab" data-toggle="tab" id="ovtaResultsTab">OVTA Results</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-body">
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane " id="areaResults" ng-controller="AreaBasedMapController">
                    <div class="row">
                        <div class="col-sm-12 col-md-2">
                            <h4>Selected Asset</h4>
                            <div id="areaBasedMapSummaryResults">
                                <p class="systemText">No asset selected</p>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-10" style="margin-top: 20px;">
                            <div id="areaBasedMapContainer">
                                <div id="@ViewDataTyped.AreaBasedMapInitJson.MapDivID" style="height: 650px; margin: 0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="treatmentBMPLegendAreaBased" style="display: none;">
                        <label>
                            <div>

                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.Full.TrashCaptureStatusTypeID), fullBmpOn)" ng-model="fullBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Full.MapboxMarkerUrlForLegend()" height="18" /> BMP (Full Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.Partial.TrashCaptureStatusTypeID), partialBmpOn)" ng-model="partialBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Partial.MapboxMarkerUrlForLegend()" height="18" /> BMP (Partial Trash Capture)
                                </span>
                            </div>
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane " id="loadResults" ng-controller="LoadBasedMapController">
                    <div class="row">
                        <div class="col-sm-12 col-md-2">
                            <h4>Selected Asset</h4>
                            <div id="loadBasedMapSummaryResults">
                                <p class="systemText">No asset selected</p>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-10" style="margin-top: 20px;">
                            <div id="loadBasedMapContainer">
                                <div id="@ViewDataTyped.LoadBasedMapInitJson.MapDivID" style="height: 650px; margin: 0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="treatmentBMPLegendLoadBased" style="display: none;">
                        <label>
                            <div>

                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.Full.TrashCaptureStatusTypeID), fullBmpOn)" ng-model="fullBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Full.MapboxMarkerUrlForLegend()" height="18" /> BMP (Full Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.Partial.TrashCaptureStatusTypeID), partialBmpOn)" ng-model="partialBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Partial.MapboxMarkerUrlForLegend()" height="18" /> BMP (Partial Trash Capture)
                                </span>
                            </div>
                        </label>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane active" id="ovtaResults" ng-controller="OVTABasedMapController">
                    <div class="row">
                        <div class="col-sm-12 col-md-2">
                            <h4>Selected Asset</h4>
                            <div id="ovtaBasedMapSummaryResults">
                                <p class="systemText">No asset selected</p>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-10" style="margin-top: 20px;">
                            <div id="ovtaBasedMapContainer">
                                <div id="@ViewDataTyped.OVTABasedMapInitJson.MapDivID" style="height: 650px; margin: 0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="treatmentBMPLegend" style="display: none;">
                        <label>
                            <div>

                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.Full.TrashCaptureStatusTypeID), fullBmpOn)" ng-model="fullBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Full.MapboxMarkerUrlForLegend()" height="18" /> BMP (Full Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.Partial.TrashCaptureStatusTypeID), partialBmpOn)" ng-model="partialBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Partial.MapboxMarkerUrlForLegend()" height="18" /> BMP (Partial Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.None.TrashCaptureStatusTypeID), noneBmpOn)" ng-model="noneBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.None.MapboxMarkerUrlForLegend()" height="18" /> BMP (No Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterBMPsByTrashCaptureStatusType(@(TrashCaptureStatusType.NotProvided.TrashCaptureStatusTypeID), notProvidedBmpOn)" ng-model="notProvidedBmpOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.NotProvided.MapboxMarkerUrlForLegend()" height="18" /> BMP (Not Provided)
                                </span>
                            </div>
                        </label>
                    </div>
                    <div id="parcelLegend" style="display: none;">
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterParcelsByTrashCaptureStatusType(@(TrashCaptureStatusType.Full.TrashCaptureStatusTypeID), fullParcelOn)" ng-model="fullParcelOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Full.SquareImageUrlForLegend()" height="12" style="margin-bottom:3px;" /> WQMP (Full Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterParcelsByTrashCaptureStatusType(@(TrashCaptureStatusType.Partial.TrashCaptureStatusTypeID), partialParcelOn)" ng-model="partialParcelOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.Partial.SquareImageUrlForLegend()" height="12" style="margin-bottom:3px;" /> WQMP (Partial Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterParcelsByTrashCaptureStatusType(@(TrashCaptureStatusType.None.TrashCaptureStatusTypeID), noneParcelOn)" ng-model="noneParcelOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.None.SquareImageUrlForLegend()" height="12" style="margin-bottom:3px;" /> WQMP (No Trash Capture)
                                </span>
                            </div>
                        </label>
                        <label>
                            <div>
                                <input type="checkbox" ng-change="filterParcelsByTrashCaptureStatusType(@(TrashCaptureStatusType.NotProvided.TrashCaptureStatusTypeID), notProvidedParcelOn)" ng-model="notProvidedParcelOn">
                                <span>
                                    <img src="@TrashCaptureStatusType.NotProvided.SquareImageUrlForLegend()" height="12" style="margin-bottom:3px;" /> WQMP (Not Provided)
                                </span>
                            </div>
                        </label>
                    </div>
                </div>@*OVTABasedMapController*@
            </div>
        </div>
    </div>
</div> 

<script>
    jQuery(document).ready(function () {
        jQuery("#treatmentBMPLegend").appendTo("#ovtaResults .leaflet-control-layers-list").toggle();
        jQuery("#parcelLegend").appendTo("#ovtaResults .leaflet-control-layers-list").toggle();
        jQuery("#treatmentBMPLegendLoadBased").appendTo("#loadResults .leaflet-control-layers-list").toggle();

    })
</script>


<script>
    function createTguDialog()
    {
        var alertHtml =
            "<div class='modal neptune-modal' style='width: 500px; margin:auto;'>" +
                "<div class='modal-dialog neptune-modal-dialog'>" +
                "<div class='modal-content'>" +
                "<div class='modal-header'>" +
                "<button type='button' class='btn btn-xs btn-neptune modal-close-button' data-dismiss='modal'><span>&times</span></button>" +
                "<span class='modal-title'>Refresh TGUs</span>" +
                "</div>" +
                "<div class='modal-body'><p>The application will now recreate the Trash Generating Unit table. This operation will take several minutes to run. Updated data will not be available until the operation is complete. The operation will run in the background and you can continue your work while it runs, but you wil not be notified when it has completed." +
                "<div class='modal-footer'>" +
                "<button type='button' class='btn btn-neptune pull-right' data-dismiss='modal'>Cancel</button>" +
                "<button type='button' class='btn btn-neptune pull-right' style='margin-right:5px;' onclick='postRefresh()' data-dismiss='modal'>Continue</a>" +
                "</div>" +
                "</div>" +
                "</div>" +
                "</div>";
        var alertDiv = jQuery(alertHtml);
        alertDiv.modal({ keyboard: true });
        alertDiv.draggable({ handle: ".modal-header" });
    }

    function postRefresh() {
        jQuery.ajax({ url: "@ViewDataTyped.RefreshTguUrl", method: "POST" });
    }
</script>