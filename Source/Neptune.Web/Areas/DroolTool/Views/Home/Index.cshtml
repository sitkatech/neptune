@using Neptune.Web.Views.Shared
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@inherits Neptune.Web.Areas.DroolTool.Views.Home.Index

@section JavascriptAndStylesContent
{
    @{ MapJavascriptIncludes.RenderPartialView(Html); }
    <script src="@Url.Content("~/ScriptsCustom/Maps/NeptuneMaps.GeoServerMap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Areas/DroolTool/Views/Home/DroolToolMap.js")" type="text/javascript"></script>
    <script>

        window.mapInitJson =
            @Html.Raw(JObject.FromObject(ViewDataTyped.StormwaterMapInitJson).ToString(Formatting.None));

        initResizeHandler(window.mapInitJson);
    </script>
    <meta name="Description" content="Neptune provides public access to program information and details on watershed, habitat, stormwater, forestry, air quality, and projects implemented by Neptune partners."/>

    <style>
        .container-fluid.droolToolContent {
            margin: 0;
            padding: 0;
            border: 0;
            width: 100%;
        }

        .neighborhood-control {
            /* todo: width should really be dynamish*/
            max-width: 410px;
        }

    </style>
}

@{ ViewPageContent.RenderPartialView(Html, ViewDataTyped.ViewPageContentViewData); }

@section DroolToolMap
{
    <div class="container-fluid" id="@ViewDataTyped.StormwaterMapInitJson.MapDivID" style="width: 100%; height: 1000px;"></div>

    <script>
        jQuery(function () {
            var map = new NeptuneMaps.GeoServerMap(window.mapInitJson, "Terrain", "@ViewDataTyped.GeoserverUrl", {});

            var neighborhoodPane = map.map.createPane("neighborhoodPane");
            neighborhoodPane.style.zIndex = 10000;
            map.map.getPane("markerPane").style.zIndex = 10001;

            var hide = false;
            var neighborhoodLayer =
                map.addWmsLayer("OCStormwater:NetworkCatchments",
                    "<span><img src='/Content/img/legendImages/networkCatchment.png' height='12px' style='margin-bottom:3px;' /> Neighborhoods</span>",
                    { pane: "neighborhoodPane", styles:"neighborhood" }, hide);

            
            map.addEsriDynamicLayer("https://ocgis.com/arcpub/rest/services/Flood/Stormwater_Network/MapServer/",
                "<span>Stormwater Network <br/> <img src='/Content/img/legendImages/stormwaterNetwork.png' height='50'/> </span>", hide);

            (new L.Control.NeighborhoodControl({position: "topleft"})).addTo(map.map);
        });

        L.Control.NeighborhoodControl = L.Control.extend({
            onAdd: function(map) {
                var el = L.DomUtil.create("div",
                    "leaflet-bar leaflet-control neptune-leaflet-control neighborhood-control");

                var h = L.DomUtil.create("p");

                h.innerHTML = "Select a neighborhood or search by address to see neighborhood details (coming soon)";
                el.append(h);
                return el;
            }
        });
    </script>
}
