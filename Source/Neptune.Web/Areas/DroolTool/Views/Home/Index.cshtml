@using Neptune.Web.Views.Shared
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@inherits Neptune.Web.Areas.DroolTool.Views.Home.Index

@section JavascriptAndStylesContent
{
    @{ MapJavascriptIncludes.RenderPartialView(Html); }
    <script src="@Url.Content("~/Content/JQuery/jquery.toast.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/ScriptsCustom/Maps/NeptuneMaps.GeoServerMap.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Areas/DroolTool/Views/Home/DroolToolMap.js")" type="text/javascript"></script>
    <link rel="stylesheet" href="@Url.Content("~/Content/JQuery/jquery.toast.min.css")" />
    <script>

        window.mapInitJson =
            @Html.Raw(JObject.FromObject(ViewDataTyped.StormwaterMapInitJson).ToString(Formatting.None));
        window.mapConfig = @Html.Raw(JObject.FromObject(ViewDataTyped.DroolToolMapConfig).ToString(Formatting.None));

        initResizeHandler(window.mapInitJson);
    </script>
    <meta name="Description" content="Neptune provides public access to program information and details on watershed, habitat, stormwater, forestry, air quality, and projects implemented by Neptune partners." />

    <style>
        .container-fluid.droolToolContent {
            margin: 0;
            padding: 0;
            border: 0;
            width: 100%;
        }

        .neighborhood-search-control {
            /* todo: width should really be dynamish*/
            width: 350px !important;
            max-width: 350px;
        }
        .neighborhood-detail-control {
            /* todo: width should really be dynamish*/
            width: 280px;
            max-width: 280px;
        }

        #nominatimSearchWrapper {
            width: 350px;
        }

        .showLocation {
            margin: 0 !important;
        }

        .selectedNeighborhoodText {
            margin-bottom: 15px;
        }

        .nominatimSearchInput {
            margin-top: 15px;
        }

        .leaflet-bottom.leaflet-right {
            width: 100%;
        }

        .explorerTray {
            width: 60%;
            height: 100px;
            background-color: #00c1d5;
            margin: 0 !important;
            border-radius: 50px 0 0;
            color: white;
            padding: 10px;
            font-size: 16px;
        }

        .explorerTray img {
            max-width: 100%;
        }


        .splashModal {
            overflow: hidden !important;
        }

        .droolToolDialog {
            background: none;
            border: none;

        }
        .droolToolDialog .ui-dialog-titlebar {
            display: none;
        }

        .droolToolSplashHeader {
            color: #ffc03f;
            font-size: 24pt;
        }

        .splashHeaderContainer {
            padding: 0 5% 0 5%
        }

        .droolToolSplashSubheader {
            color: white;
            font-size: 12pt;
        }

        .splashSubheaderContainer {
            padding: 0 5% 0 5%
        }

        .droolToolSpashCartouche {
            background-color: white;
            display: inline-block;
            padding: 10px;
            margin-top: 10px;
            width: 40%;
            border-radius: 22px;
        }

        .h2ocSplashLogo {
            max-height: 70px;
            margin-right: 25px;
        }

        .mnwdSplashLogo {
            max-height: 80px;
            margin-left: 25px;
        }

        .droolToolActionCall {
            font-size: 16pt;
            width: 340px;
            padding: 10px;
            border-radius: 22px;
        }

        .explorerTray a img:hover {
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

        @* LPT: Just use !important. Works > good*@
        .ui-widget-overlay {
            background: none !important;
            background-color: #000000 !important;
            opacity: .85 !important;
        }

        .nominatimSearchButton { }
    </style>
}

@{ ViewPageContent.RenderPartialView(Html, ViewDataTyped.ViewPageContentViewData); }

@section DroolToolMap
{
    <div class="container-fluid" id="@ViewDataTyped.StormwaterMapInitJson.MapDivID" style="width: 100%; height: 1000px;"></div>

    <script>
        jQuery(function () {
            window.map = new NeptuneMaps.DroolToolMap(window.mapInitJson, "Hillshade", "@ViewDataTyped.GeoserverUrl", window.mapConfig);

            jQuery(".leaflet-top.leaflet-right")
                .append(jQuery(".leaflet-control-zoom"));
            jQuery(".leaflet-top.leaflet-right")
                .append(jQuery(".leaflet-control-fullscreen"));

            jQuery(".showLocationWrapper").append(jQuery(".showLocation"));

            var modalWidth = jQuery(window).width() * .5;

            jQuery("#splashModal").dialog({
                dialogClass: "droolToolDialog",
                modal: true,
                width: modalWidth,
                minWidth: modalWidth,
                maxWidth: modalWidth,
                minHeight: 550,
                closeOnEscape: false
            });
            jQuery("#splashModal").dialog("open");

            function killSplash() {
                jQuery("#splashModal").dialog("close");
                window.map.intializeTray();
                jQuery("header").show();
                resizeHandler(window.mapInitJson);
            }


            jQuery("#enterAddressButton").on("click",
                function () {
                    jQuery(".callToActionContainer").hide();
                    jQuery(".splashSearchContainer").show();
                });

            jQuery("#closeSplashButton").on("click",
                function () {
                    killSplash();
                });

            jQuery("#splashModal .nominatimSearchButton").on("click",
                function() {
                    var q = jQuery("#splashModal .nominatimSearchInput").val();
                    RemoteService.nominatimLookup(q);

                    killSplash();
                });

            jQuery("#splashModal .nominatimSearchInput").on("keyup", function (event) {
                if (event.keyCode === 13) {
                    var q = jQuery("#splashModal .nominatimSearchInput").val();
                    RemoteService.nominatimLookup(q);
                    
                    killSplash();
                }
            });

        });
    </script>

    <div id="hiddenOnLoadControlElements" style="display: none;">
        <div class="row" id="nominatimSearchWrapper">
            <div class="col-sm-10">
                <div class="input-group">
                    <input type="text" class="form-control nominatimSearchInput" style="outline: currentcolor none medium; margin-top: 0; " placeholder="Search by address or landmark">
                    <span class="input-group-btn"><a class="btn btn-sm btn-neptune nominatimSearchButton" style="height: 34px; color: white; padding-top: 7px;"><i class="glyphicon glyphicon-search"></i></a></span>
                </div>
            </div>
            <div class="col-sm-2 showLocationWrapper" style="padding: 0;">

            </div>
        </div>
    </div>

    <div id="splashModal" style="overflow:hidden">
        <div class="row">
            <div class="col-sm-12 text-center">
                <img src="@Url.Content("~/Areas/DroolTool/Content/udt_color_logo.png")" style="width:60%" />
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 text-center splashHeaderContainer">
                <p class="droolToolSplashHeader">Learn about how your neighborhood is conserving water and protecting our streams and beaches</p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 text-center splashSubheaderContainer">
                <p class="droolToolSplashSubheader">The Urban Drool Tool is a collaborative project between the Moulton Niguel Water District, the County of Orange, and the Cities of Aliso Viejo, Mission Viejo, Laguna Niguel, Laguna Woods, Laguna Hills.</p>
            </div>
        </div>
        <div class="row callToActionContainer">
            <div class="col-sm-6 text-right " style="padding-right: 25px;">
                <a class="btn btn-neptune droolToolActionCall" id="enterAddressButton">Enter Address to Get Started</a>
            </div>
            <div class="col-sm-6 text-left" style="padding-left: 25px;" id="closeSplashButton">
                <a class="btn btn-neptune droolToolActionCall">Explore My Watershed</a>
            </div>
        </div>
        <div class="row splashSearchContainer" style="display: none">
            <div class="col-sm-12 text-center">
                <div class="input-group">
                    <input type="text" class="form-control nominatimSearchInput" style="outline: currentcolor none medium; margin-top: 0;" placeholder="Search by address or landmark">
                    <span class="input-group-btn"><a class="btn btn-sm btn-neptune nominatimSearchButton" style="height: 34px; color: white; padding-top: 7px;"><i class="glyphicon glyphicon-search"></i></a></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 text-center">
                <span class="droolToolSpashCartouche">
                    <img src="@Url.Content("~/Areas/DroolTool/Content/h2oc_color_logo.png")" class="h2ocSplashLogo" />
                    <img src="@Url.Content("~/Areas/DroolTool/Content/mnwd_color_logo.jpg")" class="mnwdSplashLogo" />
                </span>
            </div>
        </div>
    </div>
}