@*-----------------------------------------------------------------------
<copyright file="ConveyanceFunction.cshtml" company="Tahoe Regional Planning Agency">
Copyright (c) Tahoe Regional Planning Agency. All rights reserved.
<author>Sitka Technology Group</author>
</copyright>

<license>
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License <http://www.gnu.org/licenses/> for more details.

Source code is available upon request via <support@sitkatech.com>.
</license>
-----------------------------------------------------------------------*@
@using Neptune.Web.Models
@using LtInfo.Common.HtmlHelperExtensions
@using Newtonsoft.Json.Linq
@inherits Neptune.Web.Views.TreatmentBMPAssessment.ConveyanceFunction

@{
    SetLayout("SiteLayout.cshtml", ViewDataTyped);
}

<script type="text/javascript" src="@Url.Content("~/Areas/Stormwater/Views/TreatmentBMPAssessment/ObservationDefinedNumberOfValuesController.js")"></script>
<script type="text/javascript">
    // <![CDATA[
    angular.module("NeptuneApp")
        .factory("angularModelAndViewData",
            function()
            {
                return {
                    AngularModel: @Html.Raw(JObject.FromObject(Model)),
                    AngularViewData: @Html.Raw(JObject.FromObject(ViewDataTyped.ViewDataForAngular))
                    };
            });

    jQuery(document).ready(function () {       
        HookupCheckIfFormIsDirtyNoDisable(undefined);
    });
    // ]]>
</script>

@using (Html.BeginForm())
{
    <div class="form-horizontal">
        @if (ViewDataTyped.TreatmentBMP.InletCount + ViewDataTyped.TreatmentBMP.OutletCount == 0)
        {
            <p>
                No conveyance assessment required since this BMP has no inlets or outlets.
            </p>
        }
        else
        {
            <p>
                This BMP has @ViewDataTyped.TreatmentBMP.InletCount inlet@(ViewDataTyped.TreatmentBMP.InletCount == 1 ? string.Empty : "s") and @ViewDataTyped.TreatmentBMP.OutletCount outlet@(ViewDataTyped.TreatmentBMP.OutletCount == 1 ? string.Empty : "s"). Assessment of conveyance function is required for each inlet and outlet.
            </p>

            <p>
                Record whether each inlet and outlet on the BMP appears capable of delivering stormwater to/from the treatment BMP as intended. Use the Notes field to describe which inlet or outlet the observation applies to.
            </p>
    <div ng-app="NeptuneApp" id="ConveyanceFunctionAngularApp" ng-controller="ObservationDefinedNumberOfValuesController">
        <table class="table observationList">
            <thead>
                <tr class="row">
                    <th class="col-xs-3">@Html.Label("Location")</th>
                    <th class="col-xs-4">@Html.LabelWithSugarFor(FieldDefinition.ConveyanceFunctionsAsIntended, "Functions as Intended?")</th>
                    <th class="col-xs-5">@Html.Label("Notes")</th>
                </tr>
            </thead>
            <tr class="row" ng-repeat="row in AngularModel.TreatmentBMPObservationDetailSimples | orderBy:'TreatmentBMPObservationDetailID'">
                <td class="col-xs-3">
                    <input type="hidden" value="{{row.TreatmentBMPObservationDetailID}}"
                           name="TreatmentBMPObservationDetailSimples[{{$index}}].TreatmentBMPObservationDetailID" />
                    <input type="hidden" value="{{row.TreatmentBMPObservationDetailTypeID}}"
                           name="TreatmentBMPObservationDetailSimples[{{$index}}].TreatmentBMPObservationDetailTypeID" />
                    <span ng-bind="getTreatmentBMPObservationDetailTypeDisplayName(row)"></span>
                </td>
                <td class="col-xs-4">
                    <label class="form-check-inline" style="margin-right: 10px">
                        <input name="TreatmentBMPObservationDetailSimples[{{$index}}].TreatmentBMPObservationValue" class="form-check-input" type="radio" ng-model="row.TreatmentBMPObservationValue" value=1 required /> Yes
                    </label>
                    <label class="form-check-inline">
                        <input name="TreatmentBMPObservationDetailSimples[{{$index}}].TreatmentBMPObservationValue" class="form-check-input" type="radio" ng-model="row.TreatmentBMPObservationValue" value=0 required /> No
                    </label>
                </td>
                <td class="col-xs-5">
                    <input name="TreatmentBMPObservationDetailSimples[{{$index}}].Notes" class="form-control " type="text" ng-model="row.Notes" style="width: 100%" />
                </td>
            </tr>
        </table>
    </div>
        }

    </div>
    <div class="wizardButtonGroup">
        <hr>
        <button type="submit" class="btn btn-neptune" value="false" name="@Html.NameFor(x => x.AutoAdvance)">Save</button>
        <button type="submit" class="btn btn-neptune" value="true" name="@Html.NameFor(x => x.AutoAdvance)">Save &amp; Continue</button>
    </div>
}
