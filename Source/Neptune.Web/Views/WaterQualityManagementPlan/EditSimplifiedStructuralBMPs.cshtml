@using LtInfo.Common.HtmlHelperExtensions
@using Neptune.Web.Views.WaterQualityManagementPlan
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq

@inherits EditSimplifiedStructuralBMPs


@section JavascriptAndStylesContent
{
    <script type="text/javascript" src="@Url.Content("~/Views/WaterQualityManagementPlan/EditSimplifiedStructuralBMPsController.js")"></script>
    <script type="text/javascript">
        jQuery(function () {
            angular.module("NeptuneApp").factory("angularModelAndViewData",
                function() {
                    return {
                        AngularViewData:
                            @Html.Raw(JObject.FromObject(ViewDataTyped.ViewDataForAngular).ToString(Formatting.None)),
                        AngularModel: @Html.Raw(JObject.FromObject(Model).ToString(Formatting.None))
                    };
                });
            angular.bootstrap(jQuery('[ng-controller="EditSimplifiedStructuralBMPsController"]'), ["NeptuneApp"]);
        });
    </script>
}

<div ng-controller="EditSimplifiedStructuralBMPsController">
    @using (Html.BeginForm())
    {
        <div class="row">
            <div class="col-xs-12">
                @Html.ValidationSummary()
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <h4>Simplified Structural BMPs</h4>
                <p>
                    Describe simplified structural BMPs associated with this WQMP. This does not add records to the detailed Inventory. If the simplified model approach is selected then the percent of site, percent captured, and percent retained values will be used by the Modeling Module to determine load and volume reduction credit. In the percent of site field please enter the percentage of this WQMP site treated by each Simplified Structural BMP. The total should not exceed 100%.
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <p class="systemText" ng-if="ifAnyQuickBMPSimple(AngularModel.QuickBmpSimples) == false">There are no Other Structural BMPs associated with this WQMP. Use the Add button to enter one or more Other Structural BMPs</p>
                <table class="dialogFormLayout table table-condensed" ng-if="ifAnyQuickBMPSimple(AngularModel.QuickBmpSimples) == true">
                    <tbody>
                        <tr>
                            <th style="width: 30px; border-top:none; border-bottom: 2px solid #ddd;">  </th>
                            <th style="white-space: nowrap; border-top:none; border-bottom: 2px solid #ddd;"> Name <span class="requiredFieldIcon glyphicon glyphicon-flash" style="color: #800020; font-size: 8px; "></span></th>
                            <th style="white-space: nowrap; border-top:none; border-bottom: 2px solid #ddd;"> Type <span class="requiredFieldIcon glyphicon glyphicon-flash" style="color: #800020; font-size: 8px; "></span></th>
                            <th style="white-space: nowrap; border-top:none; border-bottom: 2px solid #ddd;"> Note</th>
                            <th style="white-space: nowrap; border-top:none; border-bottom: 2px solid #ddd;">@Html.LabelWithSugarFor(ViewDataTyped.FieldDefinitionForPercentOfSiteTreated)</th>
                            <th style="white-space: nowrap; border-top:none; border-bottom: 2px solid #ddd;">@Html.LabelWithSugarFor(ViewDataTyped.FieldDefinitionForPercentCaptured)</th>
                            <th style="white-space: nowrap; border-top:none; border-bottom: 2px solid #ddd;">@Html.LabelWithSugarFor(ViewDataTyped.FieldDefinitionForPercentRetained)</th>
                        </tr>
                        <tr ng-repeat="quickBmp in AngularModel.QuickBmpSimples">
                            <td style="border: none">
                                <input type="hidden" name="@Html.NameFor(x => x.QuickBmpSimples[0].QuickBMPID).ToString().Replace("0", "{{$index}}")" value="{{quickBmp.QuickBMPID}}" />
                                <span class="glyphicon glyphicon-trash blue" title="Remove row" alt="Remove row" ng-click="deleteQuickBMPRow(AngularModel.QuickBmpSimples, quickBmp)" style="cursor: pointer"></span>
                            </td>
                            <td style="text-align: right; padding-right: 17px; border:none">
                                <input type="text" name="@Html.NameFor(x => x.QuickBmpSimples[0].DisplayName).ToString().Replace("0", "{{$index}}")" class="form-control" ng-model="quickBmp.DisplayName" value="{{quickBmp.DisplayName}}" />
                            </td>
                            <td style="text-align: right; padding-right: 17px; border:none">
                                <select name="@Html.NameFor(x => x.QuickBmpSimples[0].QuickTreatmentBMPTypeID).ToString().Replace("0", "{{$index}}")"
                                        class="selectpicker"
                                        data-live-search="true"
                                        data-container="body"
                                        data-width="100%" selectpicker
                                        title="Select a Treatment BMP Type">
                                    <option ng-selected="isTreatmentBMPTypeSelected(treatmentType, quickBmp)"
                                            ng-repeat="treatmentType in AngularViewData.TreatmentBMPTypes"
                                            value="{{treatmentType.TreatmentBMPTypeID}}">
                                        {{treatmentType.TreatmentBMPTypeName}}
                                    </option>
                                </select>
                            </td>
                            <td style="text-align: right; padding-right: 17px; border:none">
                                <input type="text" name="@Html.NameFor(x => x.QuickBmpSimples[0].QuickBMPNote).ToString().Replace("0", "{{$index}}")" class="form-control" ng-model="quickBmp.QuickBMPNote" />
                            </td>
                            <td style="text-align: right; padding-right: 17px; border:none">
                                <input type="number" name="@Html.NameFor(x => x.QuickBmpSimples[0].PercentOfSiteTreated).ToString().Replace("0", "{{$index}}")" class="form-control" min="0" max="100" ng-model="quickBmp.PercentOfSiteTreated" />
                            </td>
                            <td style="text-align: right; padding-right: 17px; border:none">
                                <input type="number" name="@Html.NameFor(x => x.QuickBmpSimples[0].PercentCaptured).ToString().Replace("0", "{{$index}}")" class="form-control" min="0" max="100" ng-model="quickBmp.PercentCaptured" />
                            </td>
                            <td style="text-align: right; padding-right: 17px; border:none">
                                <input type="number" name="@Html.NameFor(x => x.QuickBmpSimples[0].PercentRetained).ToString().Replace("0", "{{$index}}")" class="form-control" min="0" max="100" ng-model="quickBmp.PercentRetained" />
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" style="text-align: right">
                                Untreated Percentage
                            </td>
                            <td class="text-center" style="font-weight: bold">
                                {{calculateRemainingPercent()}}%
                            </td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="col-xs-12">
                <div class="pull-right">
                    <button class="btn btn-neptune" type="button" ng-click="addQuickBMPRow(AngularModel.QuickBmpSimples)" style="margin: 0 17px 0 0">
                        <span class="glyphicon glyphicon-plus"></span> Add
                    </button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <hr/>
                <div class="pull-right">
                    <button type="submit" class="btn btn-neptune">Save</button>
                    <a href="@ViewDataTyped.WaterQualityManagementPlanDetailUrl" class="btn btn-neptune">Cancel</a>
                </div>
            </div>
        </div>
    }
</div>
