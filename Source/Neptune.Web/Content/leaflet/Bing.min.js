L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],attribution:"Bing",culture:""},initialize:function(n,t){L.Util.setOptions(this,t);this._key="AhtWhVp7sKjijM3tnGTB_WiDtP_MnjRVm-ksrAiVpb_0zwzVnO5R0sSwtQYmngvT";this._type=n;this._url=null;this.meta={};this.loadMetadata()},tile2quad:function(n,t,i){for(var r,e,u="",f=i;f>0;f--)r=0,e=1<<f-1,(n&e)!=0&&(r+=1),(t&e)!=0&&(r+=2),u=u+r;return u},getTileUrl:function(n){var t=this._getZoomForUrl(),i=this.options.subdomains,r=this.options.subdomains[Math.abs((n.x+n.y)%i.length)];return this._url.replace("{subdomain}",r).replace("{quadkey}",this.tile2quad(n.x,n.y,t)).replace("{culture}",this.options.culture)},loadMetadata:function(){var i=this,n="_bing_metadata_"+L.Util.stamp(this),r,t;window[n]=function(t){i.meta=t;window[n]=undefined;var r=document.getElementById(n);(r.parentNode.removeChild(r),t.errorDetails)||i.initMetadata()};r=document.location.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this._type+"?include=ImageryProviders&jsonp="+n+"&key="+this._key+"&UriScheme="+document.location.protocol.slice(0,-1);t=document.createElement("script");t.type="text/javascript";t.src=r;t.id=n;document.getElementsByTagName("head")[0].appendChild(t)},initMetadata:function(){var t=this.meta.resourceSets[0].resources[0],i,r,u;if(this.options.subdomains=t.imageUrlSubdomains,this._url=t.imageUrl,this._providers=[],t.imageryProviders)for(i=0;i<t.imageryProviders.length;i++)for(r=t.imageryProviders[i],u=0;u<r.coverageAreas.length;u++){var n=r.coverageAreas[u],f={zoomMin:n.zoomMin,zoomMax:n.zoomMax,active:!1},e=new L.LatLngBounds(new L.LatLng(n.bbox[0]+.01,n.bbox[1]+.01),new L.LatLng(n.bbox[2]-.01,n.bbox[3]-.01));f.bounds=e;f.attrib=r.attribution;this._providers.push(f)}this._update()},_update:function(){this._url!==null&&this._map&&(this._update_attribution(),L.TileLayer.prototype._update.apply(this,[]))},_update_attribution:function(){for(var n,r=this._map.getBounds(),i=this._map.getZoom(),t=0;t<this._providers.length;t++)n=this._providers[t],i<=n.zoomMax&&i>=n.zoomMin&&r.intersects(n.bounds)?(!n.active&&this._map.attributionControl&&this._map.attributionControl.addAttribution(n.attrib),n.active=!0):(n.active&&this._map.attributionControl&&this._map.attributionControl.removeAttribution(n.attrib),n.active=!1)},onRemove:function(n){for(var i,t=0;t<this._providers.length;t++)i=this._providers[t],i.active&&this._map.attributionControl&&(this._map.attributionControl.removeAttribution(i.attrib),i.active=!1);L.TileLayer.prototype.onRemove.apply(this,[n])}});L.bingLayer=function(n,t){return new L.BingLayer(n,t)};
//# sourceMappingURL=Bing.min.js.map
