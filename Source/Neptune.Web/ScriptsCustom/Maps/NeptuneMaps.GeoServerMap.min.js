NeptuneMaps.GeoServerMap=function(n,t,i){NeptuneMaps.Map.call(this,n,t);this.geoserverUrlOWS=i;this.wmsParams={service:"WMS",transparent:!0,version:"1.1.1",format:"image/png",info_format:"application/json",tiled:!0};this.wfsParams={service:"WFS",version:"2.0",request:"GetFeature",outputFormat:"application/json",SrsName:"EPSG:4326"}};NeptuneMaps.GeoServerMap.prototype=Sitka.Methods.clonePrototype(NeptuneMaps.Map.prototype);NeptuneMaps.GeoServerMap.prototype.createWmsParamsWithLayerName=function(n){var i={layers:n},t=Object.assign({},this.wmsParams);return L.Util.extend(t,i),t};NeptuneMaps.GeoServerMap.prototype.createWfsParamsWithLayerName=function(n){var i={typeName:n},t=Object.assign({},this.wfsParams);return L.Util.extend(t,i),t};NeptuneMaps.GeoServerMap.prototype.addWmsLayer=function(n,t){var r=this.createWmsParamsWithLayerName(n),i=L.tileLayer.wms(this.geoserverUrlOWS,r).addTo(this.map);return this.addLayerToLayerControl(i,t),i};NeptuneMaps.GeoServerMap.prototype.addWmsLayerWithParams=function(n,t,i){var r=this.createWmsParamsWithLayerName(n),u;return r=L.Util.extend(r,i),u=L.tileLayer.wms(this.geoserverUrlOWS,r).addTo(this.map),this.addLayerToLayerControl(u,t),u};NeptuneMaps.GeoServerMap.prototype.addWmsLayerWithSelectFeatureByWfs=function(n,t,i,r,u){var f=this.addWmsLayerWithParams(n,t,i);this.map.on("click",function(t){this.selectFeatureByWfs({cql_filter:"intersects(CatchmentGeometry, POINT("+t.latlng.lat+" "+t.latlng.lng+"))"},n,r,u)}.bind(this));return f};NeptuneMaps.GeoServerMap.prototype.selectFeatureByWfs=function(n,t,i,r){Sitka.Methods.isUndefinedNullOrEmpty(this.lastSelected)||(this.map.removeLayer(this.lastSelected),this.layerControl.removeLayer(this.lastSelected));var u=L.Util.extend(this.createWfsParamsWithLayerName(t),n);SitkaAjax.ajax({url:this.geoserverUrlOWS+L.Util.getParamString(u),dataType:"json",jsonpCallback:"getJson"},i,r)};