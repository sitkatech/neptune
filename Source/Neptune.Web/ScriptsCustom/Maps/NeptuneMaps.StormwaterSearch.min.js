NeptuneMaps.StormwaterSearch=function(n){var t,r,i;NeptuneMaps.Stormwater.call(this,n);t=this;r=new L.LayerGroup;t.searchableLayerGeoJson=L.geoJson(n.SearchableLayerGeoJson.GeoJsonFeatureCollection,{pointToLayer:function(n,t){var i=L.MakiMarkers.icon({icon:n.properties.FeatureGlyph,color:n.properties.FeatureColor,size:"m"});return L.marker(t,{icon:i,title:n.properties.Name,alt:n.properties.Name})},style:function(n){return{color:n.properties.FeatureColor=n.properties.FeatureColor,weight:n.properties.FeatureWeight=n.properties.FeatureWeight,fill:n.properties.FillPolygon=n.properties.FillPolygon,fillOpacity:n.properties.FillOpacity=n.properties.FillOpacity}}});i=L.markerClusterGroup({maxClusterRadius:40,showCoverageOnHover:!1,iconCreateFunction:function(n){return new L.DivIcon({html:"<div><span>"+n.getChildCount()+"<\/span><\/div>",className:"treatmentBMPCluster",iconSize:new L.Point(40,40)})}});t.searchableLayerGeoJson.addTo(i);i.addTo(this.map);t.searchableLayerGeoJson.on("click",function(n){t.markerClicked(t,n)})};NeptuneMaps.StormwaterSearch.prototype=Sitka.Methods.clonePrototype(NeptuneMaps.Stormwater.prototype);NeptuneMaps.StormwaterSearch.prototype.typeaheadSearch=function(n,t,i){var r=this,u=jQuery(n);u.typeahead({highlight:!0,minLength:1},{source:new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:i+"?term=%QUERY",wildcard:"%QUERY"}}),display:"Text",limit:Number.MAX_VALUE});u.bind("typeahead:select",function(n,t){var i=JSON.parse(t.Value);r.loadSummaryPanel(i.MapSummaryUrl);r.map.setView(new L.LatLng(i.Latitude,i.Longitude),13);r.map.invalidateSize();setTimeout(function(){r.apply(L.GeoJSON.geometryToLayer(i.GeometryJson),i.EntityID)},300)});jQuery(t).click(function(){selectFirstSuggestionFunction(u)});u.keypress(function(n){n.which==13&&(n.preventDefault(),selectFirstSuggestionFunction(this))})};lastSelected=null;NeptuneMaps.StormwaterSearch.prototype.setSelectedMarker=function(n){Sitka.Methods.isUndefinedNullOrEmpty(this.lastSelected)||this.map.removeLayer(this.lastSelected);this.lastSelected=L.geoJson(n.toGeoJSON(),{pointToLayer:function(n,t){var i=L.MakiMarkers.icon({icon:"marker",color:"#FFFF00",size:"m"});return L.marker(t,{icon:i,riseOnHover:!0})},style:function(){return{fillColor:"#FFFF00",fill:!0,fillOpacity:.2,color:"#FFFF00",weight:5,stroke:!0}}});this.lastSelected.addTo(this.map)};NeptuneMaps.StormwaterSearch.prototype.loadSummaryPanel=function(n){Sitka.Methods.isUndefinedNullOrEmpty(n)||jQuery.get(n).done(function(n){jQuery("#mapSummaryResults").empty();jQuery("#mapSummaryResults").append(n)})};NeptuneMaps.StormwaterSearch.prototype.markerClicked=function(n,t){n.setSelectedMarker(t.layer);n.loadSummaryPanel(t.layer.feature.properties.MapSummaryUrl)};