var NeptuneMaps={};NeptuneMaps.Map=function(n,t){var f=this,c,u,i,s;this.MapDivId=n.MapDivID;var l=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{}),a=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",{}),v=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{}),h=new L.TileLayer("https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",{}),e={Aerial:l,Street:a,Terrain:v},o={"Street Labels":h},r;for(t==="Hybrid"?(r=new L.LayerGroup,t="Aerial",h.addTo(r)):(Sitka.Methods.isUndefinedNullOrEmpty(t)||e[t]==null)&&(t="Terrain"),c={scrollWheelZoom:!1,layers:[e[t]],attributionControl:!1,fullscreenControl:n.AllowFullScreen?{pseudoFullscreen:!0}:!1},this.map=L.map(this.MapDivId,c),r!=null&&r.addTo(this.map),this.vectorLayers=[],u=0;u<n.Layers.length;++u){i=n.Layers[u];switch(i.LayerType){case"Vector":this.addVectorLayer(i,o);break;case"Wms":this.addWmsLayer(i,o);break;default:console.error("Invalid LayerType "+i.LayerType+" not added to map layers.")}}if(this.addLayersToMapLayersControl(e,o),s=jQuery(".modal"),!Sitka.Methods.isUndefinedNullOrEmpty(s))s.on("shown.bs.modal",function(){f.map.invalidateSize();f.setMapBounds(n)});f.setMapBounds(n)};NeptuneMaps.Map.prototype.addVectorLayer=function(n,t){var i=this,r=new L.LayerGroup,u=L.geoJson(n.GeoJsonFeatureCollection,{pointToLayer:function(t,i){var r=t.properties.FeatureColor==null?n.LayerColor:t.properties.FeatureColor;return L.marker(i,{icon:L.MakiMarkers.icon({icon:"marker",color:r,size:"s"})})},style:function(t){var i=_.includes(["Polygon","MultiPolygon"],t.geometry.type);return{color:t.properties.FeatureColor==null?n.LayerColor:t.properties.FeatureColor,weight:t.properties.FeatureWeight==null?2:t.properties.FeatureWeight,fill:t.properties.FillPolygon==null?i:t.properties.FillPolygon,fillOpacity:t.properties.FillOpacity==null?0:t.properties.FillOpacity}},onEachFeature:function(n,t){i.bindPopupToFeature(t,n)}}).addTo(r);if(n.LayerInitialVisibility===1&&r.addTo(this.map),n.HasClickThrough)u.on("click",function(n){i.clickThroughFeature(n)});else if(!n.HasCustomPopups)u.on("click",function(n){i.getFeatureInfo(n)});t[n.LayerName]=r;this.vectorLayers.push(u)};NeptuneMaps.Map.prototype.addWmsLayer=function(n,t){var i=new L.LayerGroup,r=L.Util.extend(this.wmsParams,{layers:n.MapServerLayerName}),u=L.tileLayer.wms(n.MapServerUrl,r).addTo(i);n.LayerInitialVisibility===1&&i.addTo(this.map);t[n.LayerName]=i;this.vectorLayers.push(u)};NeptuneMaps.Map.prototype.wmsParams={service:"WMS",transparent:!0,version:"1.1.1",format:"image/png",info_format:"application/json",tiled:!0};NeptuneMaps.Map.prototype.wfsParams={service:"WFS",version:"2.0",request:"GetFeature",outputFormat:"application/json",SrsName:"EPSG:4326"};NeptuneMaps.Map.prototype.addLayersToMapLayersControl=function(n,t){this.layerControl=L.control.layers(n,t);this.layerControl.addTo(this.map)};NeptuneMaps.Map.prototype.setMapBounds=function(n){this.map.fitBounds([[n.BoundingBox.Northeast.Latitude,n.BoundingBox.Northeast.Longitude],[n.BoundingBox.Southwest.Latitude,n.BoundingBox.Southwest.Longitude]])};NeptuneMaps.Map.prototype.bindPopupToFeature=function(n,t){if(!Sitka.Methods.isUndefinedNullOrEmpty(t.properties.PopupUrl)){n.bindPopup("Loading...",{maxWidth:600});n.on("click",function(){jQuery.get(t.properties.PopupUrl).done(function(t){n.bindPopup(t).openPopup()})})}};NeptuneMaps.Map.prototype.assignClickEventHandler=function(n){for(var r,i=this,t=0;t<this.vectorLayers.length;++t){r=this.vectorLayers[t];r.on("click",function(t){n(i,t)})}this.map.on("click",function(t){n(i,t)})};NeptuneMaps.Map.prototype.removeClickEventHandler=function(){for(var t,n=0;n<this.vectorLayers.length;++n)t=this.vectorLayers[n],t.off("click");this.map.off("click")};NeptuneMaps.Map.prototype.getFeatureInfo=function(n){var h=this,r=n.latlng,i="<div>",f,e,u,t,o,s;for(i+=this.formatLayerProperty("Latitude",L.Util.formatNum(r.lat,4)),i+=this.formatLayerProperty("Longitude",L.Util.formatNum(r.lng,4)),f=_(this.vectorLayers).filter(function(n){return typeof n.eachLayer!="undefined"&&h.map.hasLayer(n)}).map(function(n){return leafletPip.pointInLayer(r,n,!0)}).flatten().value(),e=_(f).map(function(n){return _.keys(n.feature.properties)}).flatten().uniq().map(function(n){return{key:n,values:_(f).map(function(t){return t.feature.properties[n]}).filter().value()}}).value(),u=0;u<e.length;u++)t=e[u],t.key!=="Short Name"&&(o=t.values.length>1?t.key+"s":t.key,s=t.values.join(", "),i+=this.formatLayerProperty(o,s));i+="<\/div>";this.map.openPopup(L.popup({minWidth:200,maxWidth:350}).setLatLng(r).setContent(i).openOn(this.map))};NeptuneMaps.Map.prototype.clickThroughFeature=function(n){var i=this,r=n.latlng,u=_(this.vectorLayers).filter(function(n){return typeof n.eachLayer!="undefined"&&i.map.hasLayer(n)}).map(function(n){return leafletPip.pointInLayer(r,n,!0)}).flatten().value(),f=u.pop().feature,t=f.properties["Target URL"];Sitka.Methods.isUndefinedNullOrEmpty(t)||(window.location.href=t)};NeptuneMaps.Map.prototype.formatLayerProperty=function(n,t){return Sitka.Methods.isUndefinedNullOrEmpty(t)&&(t="&nbsp"),'<div class="row"><div class="col-xs-4"><strong>'+n+'<\/strong><\/div><div class="col-xs-8">'+t+"<\/div><\/div>"};NeptuneMaps.Map.prototype.removeLayerFromMap=function(n){Sitka.Methods.isUndefinedNullOrEmpty(n)||this.map.removeLayer(n)};NeptuneMaps.Map.prototype.addLayerToLayerControl=function(n,t){this.layerControl.addOverlay(n,t)};NeptuneMaps.Map.prototype.disableUserInteraction=function(){this.map.dragging.disable();this.map.touchZoom.disable();this.map.doubleClickZoom.disable();this.map.scrollWheelZoom.disable();this.map.boxZoom.disable();this.map.keyboard.disable();this.map.attributionControl=!1;this.map.tap&&this.map.tap.disable();document.getElementById(this.MapDivId).style.cursor="default";jQuery(".leaflet-control-zoom").css("visibility","hidden");jQuery(".leaflet-control-layers").css("visibility","hidden");this.removeClickEventHandler()};NeptuneMaps.Map.prototype.blockMapImpl=function(){this.map.dragging.disable();this.map.scrollWheelZoom.disable();jQuery("#"+this.MapDivId).block({message:"<span style='font-weight: bold; font-size: 14px; margin: 0 2px'>Location Not Specified<\/span>",css:{border:"none",cursor:"default"},overlayCSS:{backgroundColor:"#D3D3D3",cursor:"default"},baseZ:999})};NeptuneMaps.Map.prototype.blockMap=function(){var t=this,n;this.blockMapImpl();n=jQuery(".modal");n.on("shown.bs.modal",function(){t.blockMapImpl()})};NeptuneMaps.Map.prototype.unblockMap=function(){this.map.dragging.enable();jQuery("#"+this.MapDivId).unblock()};NeptuneMaps.Map.prototype.addEsriReferenceLayer=function(n,t,i){var r=L.esri.featureLayer({url:n});r.bindPopup(i);this.addLayerToLayerControl(r,t)};